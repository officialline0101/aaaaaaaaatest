<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アンケートフォーム</title>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        /* 右端の細いナビ（固定） */
        .side-nav {
            position: fixed;
            /* 画面スクロールしても固定 */
            right: -5px;
            /* さらに右へ */
            top: 80%;
            /* 画面中央に固定 */
            transform: translateY(-50%) translateX(12px);
            /* 中央配置と右ずらし */
            background: #58453b;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4px;
            border-radius: 10px 0 0 10px;
            z-index: 1000;
            width: 35px;
            /* さらに細く */
        }

        .side-nav a:active {
            transform: scale(1.0);
            /* タップした後に元のサイズに戻す */
        }

        .side-nav a {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            font-size: 10px;
            margin: 5px 0;
            padding: 5px;
            transition: background 0.3s, transform 0.2s;
            border-radius: 5px;
            width: 30px;
            height: 30px;
            text-align: center;
        }

        .side-nav a span {
            font-size: 24px;
            /* 矢印をさらに大きく */
            position: absolute;
            left: -0px;
            /* 左端に寄せる */
            top: 13px;
            /* さらに下へ */
        }

        /* スマホ用の微調整 */
        @media (max-width: 600px) {
            .side-nav {
                right: 2px;
                /* スマホではさらに右端に */
                width: 30px;
                /* もっと細く */
            }

            .side-nav a {
                width: 28px;
                height: 28px;
            }

            .side-nav a i {
                font-size: 12px;
                /* スマホではもっと小さく */
            }
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            height: 100vh;
            margin: 0;
            padding-top: 20px;
        }

        .container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            background: linear-gradient(135deg, #58453b, #35271f);
            color: white;
            padding: 20px;
            border-radius: 0 15px 0px 45px;
            text-align: center;
            display: block;
            margin: -20px -15px 20px -15px;
            font-size: 26px;
            font-weight: 600;
            box-shadow: inset 0 -5px 10px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .label {
            display: block;
            margin-bottom: 10px;
            padding: 3px;
            font-weight: 600;
            background-color: #58453b;
            color: white;
            border-radius: 6px;
            font-size: 18px;
            text-align: center;
            /* 中央揃え */
            position: relative;
            overflow: hidden;
        }

        input[type="text"],
        input[type="tel"],
        textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .required-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            color: #58453b;
            font-weight: bold;
            font-size: 0.9em;
            border-radius: 4px;
            padding: 2px 6px;
            border: 2px solid #58453b;
        }

        input[type="text"],
        input[type="tel"],
        textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            transition: all 0.3s;
        }

        /* 対象コンテナ（縦並び） */
        .allergy-buttons,
        .limbs-buttons,
        .Mokuteki-buttons,
        .Power-buttons,
        .experience-buttons,
        .priority-buttons,
        .demand-buttons,
        .chance-buttons,
        .Introduction-buttons,
        .delivery-buttons,
        .menu-buttons {
            display: flex;
            flex-direction: column;
            /* ←縦一列 */
            gap: 10px;
            margin-bottom: 20px;
        }

        /* ボタンのベース */
        .allergy-buttons button,
        .limbs-buttons button,
        .Mokuteki-buttons button,
        .Power-buttons button,
        .experience-buttons button,
        .priority-buttons button,
        .demand-buttons button,
        .chance-buttons button,
        .Introduction-buttons button,
        .delivery-buttons button,
        .menu-buttons button {
            width: 100%;
            /* コンテナ幅いっぱい */
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f7f7f7;
            cursor: pointer;
            box-sizing: border-box;
            text-align: center;
            white-space: nowrap;
            transition: transform .18s ease, box-shadow .18s ease, background-color .18s ease, color .18s ease;
            animation: fadeSlideIn .28s ease both;
        }

        /* アクティブ状態 */
        .allergy-buttons button.active,
        .limbs-buttons button.active,
        .Mokuteki-buttons button.active,
        .Power-buttons button.active,
        .experience-buttons button.active,
        .priority-buttons button.active,
        .demand-buttons button.active,
        .chance-buttons button.active,
        .Introduction-buttons button.active,
        .delivery-buttons button.active,
        .menu-buttons button.active {
            background-color: #fc8e52;
            color: #fff;
            border-color: #fc8e52;
        }

        .submit-button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 4px;
            background-color: #322a25;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
        }

        .menu-section {
            display: none;
        }

        .menu-section.active {
            display: block;
        }

        .current-month {
            font-size: 16px;
            font-weight: bold;
            color: #444;
        }

        .menu-section {
            display: none;
        }

        .menu-section.active {
            display: block;
        }

        #repairLabel,
        #repairButtons {
            display: none;
        }

        .highlight-background {
            background-color: #f9f9d6;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            margin-top: 10px;
            /* 上に余白を追加 */
        }

        .datetime-placeholder {
            position: absolute;
            top: 50%;
            left: 15px;
            transform: translateY(-50%);
            color: #aaa;
            font-size: 16px;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        /* 基本スタイル */
        .info-text {
            margin: 20px 0;
            font-family: "Noto Sans JP", "Roboto", sans-serif;
            font-size: 14px;
            color: #333;
            /* 読みやすい濃い文字色 */
            background-color: #f8f9fa;
            line-height: 1.8;
            text-align: left;
            word-wrap: break-word;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ced4da;
            max-width: 800px;
            /* 横幅制限 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            /* 軽い影を追加 */
            overflow-y: auto;
            /* 長文スクロール対応 */
        }

        /* 見出しスタイル */
        .info-text h1 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .info-text h2 {
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        /* 強調テキスト */
        .info-text strong {
            color: #007bff;
        }

        /* モバイル向け調整 */
        @media (max-width: 768px) {
            .info-text {
                font-size: 13px;
                padding: 15px;
                max-width: 100%;
            }

            .info-text h1 {
                font-size: 16px;
            }

            .info-text h2 {
                font-size: 14px;
            }
        }

        .info-textmemo {
            margin-top: 20px;
            /* 上の余白 */
            margin-bottom: 10px;
            /* 下に白い隙間を追加 */
            font-size: 13px;
            color: #000000;
            line-height: 1.5;
            text-align: center;
            word-wrap: break-word;
            background-color: #eef9f5;
            /* 青っぽい背景色を追加 */
            padding: 10px;
            border-radius: 4px;
        }

        /* 携帯端末向けのレスポンシブデザイン */
        @media (max-width: 768px) {
            .info-textmemo {
                font-size: 11.5px;
                /* スマホでは少し小さく */
                margin-top: 10px;
                /* 上下のマージンを調整 */
                line-height: 2.0;
                /* テキストの高さ調整 */
            }
        }


        /* 100点の予約フォームCSS */

        input:focus,
        textarea:focus {
            border-color: #58453b;
            outline: none;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.2);
        }

        button {
            padding: 12px;
            border: none;
            border-radius: 6px;
            background-color: #58453b;
            color: #000000;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background-color: #f0f0f0;
            transform: scale(1.00);
        }

        .submit-button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            background-color: #979797;
        }

        .submit-button:hover {
            background-color: #979797;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 22px;
            }

            input,
            button {
                font-size: 14px;
            }
        }

        button.active {
            outline: 2px solid #fc8e52;
            /* ここで枠線を指定 */
            outline-offset: 2px;
            /* 外側に色を追加 */
            box-shadow: 0 0 0 3px #6f5031
        }

        /* 必須マークのスタイル */
        .required {
            color: #ffffff;
            /* ゴールド（黄色） */
            font-weight: lighter;
            /* 文字を細くする */
            font-size: 0.6em;
            margin-left: 5px;
            vertical-align: 0.8em;
            /* 位置を少し上に調整 */

            /* 白色背景の四角形 */
            background-color: rgb(255, 15, 15);
            padding: 0 5px;
            border-radius: 3px;
            margin-right: 5px;
        }

        .current-month {
            text-align: center;
            display: block;
            position: absolute;
            left: 50%;
            transform: translate(-50%, -10px);
            /* Y方向に上げる */
            background-color: #58453b;
            color: #fff;
            padding: 3px 12px;
            /* ボックスのパディングを縮小 */
            border-radius: 8px;
            /* 角の丸みを少し減少 */
            font-size: 1.4rem;
            /* フォントサイズを小さく */
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(47, 103, 167, 0.2);
            /* 影も控えめに */
        }

        /* ナビゲーションバー */
        .sidebar {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: #1e1e2d;
            padding: 10px;
            border-radius: 10px 0 0 10px;
            z-index: 1000;
        }

        .sidebar a {
            display: block;
            padding: 15px;
            color: white;
            text-decoration: none;
            text-align: center;
            font-size: 14px;
            margin-bottom: 10px;
            background: #4a90e2;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .sidebar a:hover {
            background: #357ac4;
        }

        /* スクロール用のセクション */
        .section {
            padding: 50px 10px;
            margin-top: 30px;
        }

        .small-text {
            font-size: 18px;
            /* 好きなサイズに変更可能 */
        }

        .birth-row {
            display: flex;
            gap: 10px;
            margin: 8px 0 20px;
        }

        .birth-select {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
            background: #fff;
        }

        .zip-row,
        .addr-row,
        .addr-street-row {
            display: flex;
            gap: 10px;
            margin: 8px 0 12px;
        }

        .zip-row input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .zip-search-btn {
            padding: 9px 10px;
            border: none;
            border-radius: 6px;
            background: #58453b;
            color: #fff;
            cursor: pointer;
            position: relative;
            /* ← 相対位置指定を有効に */
            top: -10px;
            /* ← 上に12pxずらす */
        }

        .zip-row {
            align-items: center;
            transform: translateY(7px);
            /* ← 見た目だけ下へ5px */
        }

        .addr-row input,
        .addr-street-row input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .zip-help {
            font-size: 12px;
            color: #666;
            margin-top: -11px;
        }
    </style>
</head>

<body>
    <!-- 右側の追従ナビ -->
    <div class="side-nav" id="sideNav">
        <a href="#section-message">
            <span>⇩</span>
            <i class="fas fa-comment"></i>
        </a>
    </div>

    <div class="container">
        <h1><span class="small-text">ホームネイルサロンROSARIUM</span><br>アンケートフォーム</h1>
        <div class="info-text">以下全て入力後【アンケート送信】ボタンを押してください。</div>

        <div class="label">　　お名前　（漢字）<span class="required">必須</span></div>
        <textarea id="message" rows="1" placeholder="入力してください"></textarea> <!-- メッセージ入力フィールド -->

        <div class="label">　　お名前　（フリガナ）<span class="required">必須</span></div>
        <textarea id="message2" rows="1" placeholder="入力してください"></textarea> <!-- メッセージ入力フィールド -->

        <div class="label">　　誕生日（西暦）<span class="required">必須</span></div>
        <div class="birth-row">
            <select id="birthYear" class="birth-select" aria-label="西暦（年）">
                <option value="">西暦</option>
            </select>
            <select id="birthMonth" class="birth-select" aria-label="月">
                <option value="">月</option>
            </select>
            <select id="birthDay" class="birth-select" aria-label="日">
                <option value="">日</option>
            </select>
        </div>
        <!-- 送信互換のため隠しフィールド（YYYY-MM-DD） -->
        <input type="hidden" id="message3" />

        <div class="label">　　電話番号<span class="required">必須</span></div>
        <input id="message4" type="tel" inputmode="tel" autocomplete="tel" placeholder="例）09012345678"
            pattern="^0[\d-]{9,13}$" title="先頭は0、半角数字で入力してください" />

        <div class="label">　　ご住所<span class="required">必須</span></div>

        <!-- 郵便番号＋検索 -->
        <div class="zip-row">
            <input id="zipCode" type="text" inputmode="numeric" pattern="\d{3}-?\d{4}" placeholder="例）123-4567"
                aria-label="郵便番号">
            <button type="button" class="zip-search-btn" onclick="searchAddressByZip()">住所検索</button>
        </div>
        <div id="zipHelp" class="zip-help">郵便番号を入力して「住所検索」をタップしてください。</div>

        <!-- 自動入力される項目 -->
        <div class="addr-row">
            <input id="addrPref" type="text" placeholder="都道府県（自動入力）" aria-label="都道府県">
            <input id="addrCity" type="text" placeholder="市区町村・町域（自動入力）" aria-label="市区町村・町域">
        </div>

        <!-- ユーザーが入力する項目 -->
        <div class="addr-street-row">
            <input id="addrStreet" type="text" placeholder="丁目・番地・号・建物名" aria-label="丁目・番地・号・建物名">
        </div>

        <!-- 送信互換：合成済みのフル住所を入れる（submitFormはこの値を読む） -->
        <input type="hidden" id="message5" />

        <!-- 施術中（単一選択） -->
        <div class="label">　　施術中<span class="required">必須</span><br>（複数回答可）</div>
        <div class="chance-buttons" id="chanceGroup">
            <button type="button" id="chanceTalk" onclick="selectChance(this)">楽しく会話したい</button>
            <button type="button" id="chanceMovie1" onclick="selectChance(this)">動画鑑賞</button>
            <button type="button" id="chanceMovie2" onclick="selectChance(this)">動画鑑賞</button>
        </div>

        <!-- 当店を選んだ理由（複数選択＋紹介者名） -->
        <div class="label">　　当店を選んでくださった理由を<span class="required">必須</span><br>教えてください<br>（複数回答可）</div>
        <div class="demand-buttons" id="reasonGroup">
            <button type="button" id="reasonGMB" onclick="selectReason(this)">Googleマイビジネス（クチコミ）</button>
            <button type="button" id="reasonNear" onclick="selectReason(this)">近かった</button>
            <button type="button" id="reasonAds" onclick="selectReason(this)">WEB広告</button>
            <button type="button" id="reasonFacebook" onclick="selectReason(this)">Facebook</button>
            <button type="button" id="reasonInsta" onclick="selectReason(this)">Instagram</button>
            <button type="button" id="reasonHP" onclick="selectReason(this)">ホームページ</button>
            <button type="button" id="reasonReferral" onclick="selectReason(this)">ご紹介</button>

            <!-- 紹介者名の入力欄 -->
            <div id="reasonReferralWrap" class="demand-other-wrap">
                <div class="label">　　ご紹介者様のお名前をお書きください<span class="required">必須</span></div>
                <input id="reasonReferralInput" type="text" placeholder="ご紹介者名を入力してください" />
            </div>
        </div>

        <!-- 職業（単一選択＋その他） -->
        <div class="label">　　職業<span class="required">必須</span></div>
        <div class="priority-buttons" id="jobGroup">
            <button type="button" id="jobCompany" onclick="selectJob(this)">会社員</button>
            <button type="button" id="jobPublic" onclick="selectJob(this)">公務員</button>
            <button type="button" id="jobTeacher" onclick="selectJob(this)">教師</button>
            <button type="button" id="jobNurse" onclick="selectJob(this)">看護師</button>
            <button type="button" id="jobBeauty" onclick="selectJob(this)">理・美容師</button>
            <button type="button" id="jobTherapist" onclick="selectJob(this)">整体・エステ</button>
            <button type="button" id="jobNursery" onclick="selectJob(this)">保育士</button>
            <button type="button" id="jobSelf" onclick="selectJob(this)">自営業</button>
            <button type="button" id="jobPart" onclick="selectJob(this)">パート</button>
            <button type="button" id="jobOther" onclick="selectJob(this)">専業主婦・その他</button>
        </div>
        <div id="jobOtherWrap" style="display:none; margin:10px 0 20px;">
            <div class="label">他の方はこちらにお書きください</div>
            <input id="jobOtherInput" type="text" placeholder="その他の内容を入力してください" />
        </div>

        <!-- 趣味（単一選択＋その他） -->
        <div class="label">　　趣味<span class="required">必須</span><br>（複数回答可）</div>
        <div class="Mokuteki-buttons" id="hobbyGroup">
            <button type="button" id="hobbyTrip" onclick="selectHobby(this)">旅行</button>
            <button type="button" id="hobbySports" onclick="selectHobby(this)">スポーツ</button>
            <button type="button" id="hobbyMovie" onclick="selectHobby(this)">映画</button>
            <button type="button" id="hobbyMusic" onclick="selectHobby(this)">音楽</button>
            <button type="button" id="hobbyCooking" onclick="selectHobby(this)">料理</button>
            <button type="button" id="hobbyOther" onclick="selectHobby(this)">その他</button>
        </div>
        <div id="hobbyOtherWrap" style="display:none; margin:10px 0 20px;">
            <div class="label">他の方はこちらにお書きください</div>
            <input id="hobbyOtherInput" type="text" placeholder="その他の内容を入力してください" />
        </div>

        <!-- 爪・手足の状態（単一選択＋その他） -->
        <div class="label">　　爪・手足の状態について<span class="required">必須</span><br>気になることを教えてください<br>（複数回答可）</div>
        <div class="limbs-buttons" id="nailsGroup">
            <button type="button" id="nailsDouble" onclick="selectNails(this)">二枚爪</button>
            <button type="button" id="nailsWarp" onclick="selectNails(this)">爪がそる</button>
            <button type="button" id="nailsLines" onclick="selectNails(this)">縦筋がある</button>
            <button type="button" id="nailsColor" onclick="selectNails(this)">変色</button>
            <button type="button" id="nailsBig" onclick="selectNails(this)">大きい</button>
            <button type="button" id="nailsSmall" onclick="selectNails(this)">小さい</button>
            <button type="button" id="nailsFlat" onclick="selectNails(this)">平べったい</button>
            <button type="button" id="nailsFan" onclick="selectNails(this)">扇形</button>
            <button type="button" id="nailsFragile" onclick="selectNails(this)">割れやすい</button>
            <button type="button" id="nailsOther" onclick="selectNails(this)">その他</button>
        </div>
        <div id="nailsOtherWrap" style="display:none; margin:10px 0 20px;">
            <div class="label">他の方はこちらにお書きください</div>
            <input id="nailsOtherInput" type="text" placeholder="その他の内容を入力してください" />
        </div>

        <!-- 普段のネイルの持ち（単一選択） -->
        <div class="label">　普段のネイルの<span class="required">必須</span><br>持ちについて教えてください</div>
        <div class="Introduction-buttons" id="holdGroup">
            <button type="button" id="holdFirst" onclick="selectHold(this)">ネイルするのが初めて</button>
            <button type="button" id="hold1w" onclick="selectHold(this)">1週間以内</button>
            <button type="button" id="hold2to3w" onclick="selectHold(this)">2週間～3週間</button>
            <button type="button" id="hold4w" onclick="selectHold(this)">4週間以上</button>
        </div>

        <!-- 取れやすい爪（単一選択） -->
        <div class="label">　　取れやすい爪はありますか？<span class="required">必須</span><br>（複数回答可）</div>
        <div class="delivery-buttons" id="fragileFingerGroup">
            <button type="button" id="fragileThumb" onclick="selectFragileFinger(this)">親指</button>
            <button type="button" id="fragileIndex" onclick="selectFragileFinger(this)">人差し指</button>
            <button type="button" id="fragileMiddle" onclick="selectFragileFinger(this)">中指</button>
            <button type="button" id="fragileRing" onclick="selectFragileFinger(this)">薬指</button>
            <button type="button" id="fragileLittle" onclick="selectFragileFinger(this)">小指</button>
            <button type="button" id="fragileAll" onclick="selectFragileFinger(this)">全体的</button>
            <button type="button" id="fragilewakarani" onclick="selectFragileFinger(this)">とくになし</button>
        </div>

        <!-- 取れ方（単一選択） -->
        <div class="label">　　取れ方について教えてください<span class="required">必須</span></div>
        <div class="Power-buttons" id="peelGroup">
            <button type="button" id="peelWeak" onclick="selectPeel(this)">先端が剥がれる</button>
            <button type="button" id="peelSlight" onclick="selectPeel(this)">側面が剝がれる</button>
            <button type="button" id="peelNormal" onclick="selectPeel(this)">中心が白くなって浮く</button>
            <button type="button" id="peelSlightHi" onclick="selectPeel(this)">根元側が剥がれる</button>
            <button type="button" id="peelStrong" onclick="selectPeel(this)">持ちは良い</button>
            <button type="button" id="wakaranaiStrong" onclick="selectPeel(this)">分からない</button>
        </div>

        <!-- 手の使い方/指先の使用頻度（単一選択） -->
        <div class="label">　手の使い方、指先の使用頻度<span class="required">必須</span><br>について教えてください。<br>（複数回答可）</div>
        <div class="experience-buttons" id="handUsageGroup">
            <button type="button" id="handUseiti" onclick="selectHandUsage(this)">日常生活で指先をよく使う<br>（爪先でシールを剥がす等）</button>
            <button type="button" id="handUseni" onclick="selectHandUsage(this)">水仕事が多い</button>
            <button type="button" id="handUsesan" onclick="selectHandUsage(this)">パソコン作業が多い</button>
            <button type="button" id="handUseyon" onclick="selectHandUsage(this)">小さい子供がいる</button>
            <button type="button" id="handUsegoo" onclick="selectHandUsage(this)">薬品（消毒など）よく使う</button>
            <button type="button" id="handUseroku" onclick="selectHandUsage(this)">爪を噛む・ささくれを剥く</button>
            <button type="button" id="handUsesiti" onclick="selectHandUsage(this)">ガーデニングなど土をよく触る</button>
            <button type="button" id="handUsehati" onclick="selectHandUsage(this)">指先を酷使することはない</button>
        </div>

        <!-- 今までのサロンで嫌だった事（単一選択：暫定5段階） -->
        <div class="label">　今までのサロンで嫌だった事<span class="required">必須</span><br>があれば教えてください。<br>（複数回答可）</div>
        <div class="Power-buttons" id="dislikeGroup">
            <button type="button" id="dislike1" onclick="selectDislike(this)">接客態度</button>
            <button type="button" id="dislike2" onclick="selectDislike(this)">熱い、痛い</button>
            <button type="button" id="dislike3" onclick="selectDislike(this)">仕上がり</button>
            <button type="button" id="dislike4" onclick="selectDislike(this)">特になし</button>
        </div>

        <!-- お仕事でOKな範囲（単一選択） -->
        <div class="label">　　お仕事でOKな範囲を教えてください。<span class="required">必須</span><br>（複数回答可）</div>
        <div class="experience-buttons" id="workScopeGroup">
            <button type="button" id="workOkYes" onclick="selectWorkScope(this)">自爪風</button>
            <button type="button" id="workOkNo" onclick="selectWorkScope(this)">ナチュラル</button>
            <button type="button" id="workOkYesa" onclick="selectWorkScope(this)">ハッキリした色でもパーツが無ければOK</button>
            <button type="button" id="workOkNos" onclick="selectWorkScope(this)">制限なし</button>
        </div>

        <div class="label">好きな色、やってみたい色<br>はありますか？</div>
        <textarea id="message6" rows="1" placeholder="入力してください"></textarea> <!-- メッセージ入力フィールド -->

        <!-- ネイルをすることの目的（単一選択：暫定5段階） -->
        <div class="label">　　ネイルをすることの<span class="required">必須</span><br>目的・得たいことはなんですか？<br>（複数回答可）</div>
        <div class="Power-buttons" id="purposeGroup">
            <button type="button" id="purpose1" onclick="selectPurpose(this)">弱め</button>
            <button type="button" id="purpose2" onclick="selectPurpose(this)">やや弱め</button>
            <button type="button" id="purpose3" onclick="selectPurpose(this)">普通</button>
            <button type="button" id="purpose4" onclick="selectPurpose(this)">やや強め</button>
            <button type="button" id="purpose5" onclick="selectPurpose(this)">強め</button>
        </div>

        <!-- 興味のあるメニュー（単一選択） -->
        <div class="label">　　興味のあるメニューはなんですか？<span class="required">必須</span><br>（複数回答可）</div>
        <div class="experience-buttons" id="interestGroup">
            <button type="button" id="interestYes" onclick="selectInterest(this)">ジェルネイル</button>
            <button type="button" id="interestNo" onclick="selectInterest(this)">自爪育成・ケア</button>
            <button type="button" id="interestYessan" onclick="selectInterest(this)">歯のホワイトニング</button>
            <button type="button" id="interestNoyon" onclick="selectInterest(this)">スペシャルハンドトリートメント</button>
            <button type="button" id="interestYesgo" onclick="selectInterest(this)">ドライヘッドスパ</button>
        </div>

        <!-- タバコは吸われますか？ -->
        <div class="label">　　タバコは吸われますか？<span class="required">必須</span></div>
        <div class="experience-buttons" id="tabakoGroup">
            <button type="button" id="tabakoYes" onclick="selecttabako(this)">吸う</button>
            <button type="button" id="tabakoNo" onclick="selecttabako(this)">吸わない</button>
        </div>

        <!-- 追質問（吸うと答えた方のみ表示） -->
        <div id="tabakoFollow" style="display:none;">
            <div class="label">　　吸うと答えられた人は<span class="required">必須</span><br>下記もお答えください<br>（複数回答可）</div>
            <div class="experience-buttons" id="tabakodottiGroup">
                <button type="button" id="tabakodottiYes" onclick="selecttabakodotti(this)">紙タバコ</button>
                <button type="button" id="tabakodottiNo" onclick="selecttabakodotti(this)">電子タバコ</button>
            </div>
        </div>


        <!-- アレルギー（単一選択＋詳細） -->
        <div class="label">　　アレルギーはありますか？<span class="required">必須</span><br>（複数回答可）</div>
        <div class="allergy-buttons" id="allergyGroup">
            <button type="button" id="allergyYes" onclick="selectAllergy(this)">ある</button>
            <button type="button" id="allergyNo" onclick="selectAllergy(this)">なし</button>
        </div>
        <div id="allergyOtherWrap" style="display:none; margin:10px 0 20px;">
            <div class="label">あるを選んだ方はお書きください</div>
            <input id="allergyOtherInput" type="text" placeholder="アレルギー内容を入力してください" />
        </div>

        <div class="label">備考</div>
        <textarea id="message2" rows="4" placeholder="メッセージを入力してください"></textarea>

        <button class="submit-button" onclick="submitForm()" div id="section-message">送信</button>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script> <!-- LIFF SDKの読み込み -->
    <script>
        let chanceValue = [];
        let reasonValues = [];           // 複数選択
        let jobValue = '';
        let hobbyValue = [];
        let nailsValue = [];
        let holdValue = [];
        let fragileFingerValue = [];
        let peelValue = [];
        let dislikeValue = [];
        let handUsageValue = [];
        let workScopeValue = [];
        let purposeValue = [];
        let interestValue = [];
        let smokingValue = [];
        let allergyValue = [];
        let allergyDetail = [];
        let reasonReferralName = '';
        let tabakoValue = '';        // 「吸う / 吸わない」
        let tabakodottiValue = [];   // 「紙タバコ / 電子タバコ」（単一選択）

        // ★ 追加
        let isPriorityOtherActive = false;
        let isDemandOtherActive = false;
        let islimbsOtherActive = false;
        let isMokutekiOtherActive = false;

        // LIFF初期化
        document.addEventListener('DOMContentLoaded', function () {
            liff.init({
                liffId: '2005254357-zKma9BZk' // ここにあなたのLIFF IDを入力
            }).then(() => {
                // LIFF初期化成功時の処理
                console.log('LIFF初期化成功');
            }).catch((err) => {
                // LIFF初期化失敗時の処理
                console.error('LIFF初期化失敗', err);
            });
        });

        function normalizeZip(v) {
            return (v || '').toString().replace(/[^\d]/g, '').slice(0, 7);
        }
        function composeFullAddress() {
            const pref = (document.getElementById('addrPref')?.value || '').trim();
            const city = (document.getElementById('addrCity')?.value || '').trim();
            const street = (document.getElementById('addrStreet')?.value || '').trim();
            document.getElementById('message5').value = [pref, city, street].filter(Boolean).join('');
        }

        // 郵便番号→住所検索（ZipCloud）
        async function searchAddressByZip() {
            const help = document.getElementById('zipHelp');
            const raw = document.getElementById('zipCode')?.value || '';
            const zip = normalizeZip(raw);

            if (zip.length !== 7) {
                help.textContent = '郵便番号は7桁で入力してください（例：123-4567）。';
                help.style.color = '#b00020';
                return;
            }
            help.textContent = '検索中...'; help.style.color = '#666';

            try {
                const res = await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${zip}`);
                const data = await res.json();

                if (data.status !== 200 || !data.results || !data.results.length) {
                    help.textContent = '住所が見つかりませんでした。番号をご確認ください。';
                    help.style.color = '#b00020';
                    return;
                }

                const r = data.results[0];
                // r.address1=都道府県, address2=市区町村, address3=町域
                const pref = r.address1 || '';
                const city = [r.address2 || '', r.address3 || ''].join('');

                document.getElementById('addrPref').value = pref;
                document.getElementById('addrCity').value = city;

                help.textContent = '住所を自動入力しました。丁目・番地・号を入力してください。';
                help.style.color = '#0a7f2e';

                composeFullAddress();
                document.getElementById('addrStreet').focus();
            } catch (e) {
                console.error(e);
                help.textContent = 'エラーが発生しました。通信環境をご確認ください。';
                help.style.color = '#b00020';
            }
        }

        // 手入力での修正にも追随してフル住所を合成
        ['addrPref', 'addrCity', 'addrStreet'].forEach(id => {
            document.getElementById(id)?.addEventListener('input', composeFullAddress);
        });
        // 郵便番号入力の補正（全角→半角、数字以外除去、3-4の見た目整形はお好みで）
        document.getElementById('zipCode')?.addEventListener('input', (e) => {
            const half = e.target.value.replace(/[０-９ー－]/g, ch =>
                String.fromCharCode(ch.charCodeAt(0) - 0xFEE0)
            );
            e.target.value = half.replace(/[^\d-]/g, '');
        });

        // 電話入力の補正（全角→半角、数字とハイフン以外除去）
        document.getElementById('message4')?.addEventListener('input', (e) => {
            const toHalf = (s) => s.replace(/[０-９－]/g, (ch) =>
                String.fromCharCode(ch.charCodeAt(0) - 0xFEE0)
            );
            let v = toHalf(e.target.value);
            v = v.replace(/[^\d-]/g, ''); // 数字とハイフンのみ許可
            e.target.value = v;
        });

        // プレースホルダーを非表示にする関数
        function hidePlaceholder(placeholderId) {
            document.getElementById(placeholderId).style.display = 'none';
        }

        // プレースホルダーを表示する関数（入力がない場合）
        function showPlaceholder(inputId, placeholderId) {
            const input = document.getElementById(inputId);
            if (!input.value) {
                document.getElementById(placeholderId).style.display = 'inline';
            }
        }

        // === 汎用：単一選択の active 切り替え ===
        function setActiveSingle(parentSelector, clickedEl) {
            document.querySelectorAll(`${parentSelector} button`).forEach(b => b.classList.remove('active'));
            clickedEl.classList.add('active');
        }

        // 施術中（複数選択可）
        function selectChance(el) {
            // 押したボタンのON/OFF
            el.classList.toggle('active');

            // 選択中のボタンテキストを収集（重複は除外）
            const selected = Array.from(document.querySelectorAll('#chanceGroup button.active'))
                .map(b => b.innerText);
            const unique = Array.from(new Set(selected));

            // 既存submitForm互換：文字列で保持（空なら ""）
            chanceValue = unique.length ? unique.join('、') : '';

            // 配列で使いたい場合はコレを参照（任意）
            window.chanceValues = unique;
        }

        // 当店を選んだ理由（複数＋紹介名）
        function selectReason(el) {
            el.classList.toggle('active');

            const referralBtn = document.getElementById('reasonReferral');
            const referralWrap = document.getElementById('reasonReferralWrap');
            const referralInput = document.getElementById('reasonReferralInput');

            // 紹介ボタンのON/OFFで入力欄切替
            if (el.id === 'reasonReferral') {
                if (el.classList.contains('active')) {
                    referralWrap.classList.add('show');
                    referralWrap.style.display = 'block';
                    setTimeout(() => referralInput.focus(), 0);
                } else {
                    referralWrap.classList.remove('show');
                    referralWrap.style.display = 'none';
                    referralInput.value = '';
                    reasonReferralName = '';
                }
            }

            // 現在の選択リストを再構築
            let texts = Array.from(document.querySelectorAll('#reasonGroup button.active'))
                .map(b => b.innerText);

            // 「ご紹介」ONなら、ラベルを実名に置き換え
            if (referralBtn.classList.contains('active')) {
                const v = referralInput.value.trim();
                reasonReferralName = v;
                texts = texts.filter(t => t !== 'ご紹介');
                if (v) texts.push(`ご紹介（${v}）`);
                referralInput.oninput = () => {
                    const val = referralInput.value.trim();
                    reasonReferralName = val;
                    let cur = Array.from(document.querySelectorAll('#reasonGroup button.active'))
                        .map(b => b.innerText)
                        .filter(t => t !== 'ご紹介');
                    if (val) cur.push(`ご紹介（${val}）`);
                    reasonValues = cur;
                };
            }
            reasonValues = texts;
        }

        // 職業
        function selectJob(el) {
            setActiveSingle('#jobGroup', el);
            jobValue = el.innerText;
            const wrap = document.getElementById('jobOtherWrap');
            const input = document.getElementById('jobOtherInput');
            if (el.id === 'jobOther') {
                wrap.style.display = 'block';
                jobValue = input.value.trim() || '専業主婦・その他';
                input.oninput = () => jobValue = (input.value.trim() || '専業主婦・その他');
            } else {
                wrap.style.display = 'none';
                input.value = '';
            }
        }

        // 趣味（複数選択可＋「その他」入力対応）
        function selectHobby(el) {
            // クリック要素のON/OFF
            el.classList.toggle('active');

            const groupSel = '#hobbyGroup';
            const wrap = document.getElementById('hobbyOtherWrap');
            const input = document.getElementById('hobbyOtherInput');
            const otherBtn = document.getElementById('hobbyOther');

            // 「その他」ボタンの表示/非表示
            if (el.id === 'hobbyOther') {
                if (el.classList.contains('active')) {
                    wrap.style.display = 'block';
                    // 初期値反映（空なら「その他」で保持）
                    const v0 = (input.value || '').trim();
                    // 直ちに全体の集合を再構築
                    rebuild();
                    // 入力中もリアルタイム更新
                    input.oninput = () => rebuild();
                    // フォーカス
                    setTimeout(() => input.focus(), 0);
                } else {
                    // OFFになったら入力欄を閉じてクリア
                    wrap.style.display = 'none';
                    input.value = '';
                    rebuild();
                }
            } else {
                // 通常ボタンのON/OFF時も全体を再構築
                rebuild();
            }

            // 選択値の再構築（配列＋結合文字列の両方を更新）
            function rebuild() {
                // 現在activeなボタンのテキストを収集
                let texts = Array.from(document.querySelectorAll(`${groupSel} button.active`))
                    .map(b => b.innerText);

                // 「その他」が選ばれている場合、入力値で置き換え
                if (otherBtn.classList.contains('active')) {
                    const v = (input.value || '').trim();
                    // まず「その他」ラベルを除外
                    texts = texts.filter(t => t !== 'その他');
                    // 入力があればそれを、なければプレースホルダとして「その他」
                    texts.push(v || 'その他');
                }

                // 重複排除
                const unique = Array.from(new Set(texts));

                // 既存submitForm互換：カンマ区切り文字列／空なら""
                hobbyValue = unique.length ? unique.join('、') : '';

                // 配列で使いたい場合はこちら
                window.hobbyValues = unique;
            }
        }

        // 爪・手足の状態（複数選択可＋「その他」入力対応）
        function selectNails(el) {
            // クリック要素のON/OFF
            el.classList.toggle('active');

            const groupSel = '#nailsGroup';
            const wrap = document.getElementById('nailsOtherWrap');
            const input = document.getElementById('nailsOtherInput');
            const otherBtn = document.getElementById('nailsOther');

            // 「その他」ボタンの表示/非表示制御
            if (el.id === 'nailsOther') {
                if (el.classList.contains('active')) {
                    wrap.style.display = 'block';
                    // 初期反映＆入力のたびに再構築
                    rebuild();
                    input.oninput = () => rebuild();
                    setTimeout(() => input.focus(), 0);
                } else {
                    wrap.style.display = 'none';
                    input.value = '';
                    rebuild();
                }
            } else {
                // 通常ボタンのON/OFF時
                rebuild();
            }

            // 選択値の再構築
            function rebuild() {
                // 現在activeなボタンのラベルを収集
                let texts = Array.from(document.querySelectorAll(`${groupSel} button.active`))
                    .map(b => b.innerText);

                // 「その他」がONのとき、入力値で置き換え
                if (otherBtn.classList.contains('active')) {
                    const v = (input.value || '').trim();
                    texts = texts.filter(t => t !== 'その他'); // ラベル除外
                    texts.push(v || 'その他');                // 入力が空なら「その他」で保持
                }

                // 重複排除
                const unique = Array.from(new Set(texts));

                // 既存submitForm互換：カンマ風の読点「、」で結合（空なら ""）
                nailsValue = unique.length ? unique.join('、') : '';

                // 配列で使いたい場合はこちら
                window.nailsValues = unique;
            }
        }

        // 普段の持ち
        function selectHold(el) {
            setActiveSingle('#holdGroup', el);
            holdValue = el.innerText;
        }

        // 取れやすい爪（複数選択可）
        function selectFragileFinger(el) {
            // クリック要素のON/OFF
            el.classList.toggle('active');

            // 選択中ラベルを収集 → 重複排除
            const selected = Array.from(document.querySelectorAll('#fragileFingerGroup button.active'))
                .map(b => b.innerText);
            const unique = Array.from(new Set(selected));

            // 既存 submitForm 互換：読点で結合（空なら ""）
            fragileFingerValue = unique.length ? unique.join('、') : '';

            // 配列で扱いたい場合はこちら
            window.fragileFingerValues = unique;
        }

        // 取れ方（複数選択可）
        function selectPeel(el) {
            // ボタンのON/OFF
            el.classList.toggle('active');

            // 選択中のラベルを収集 → 重複排除
            const selected = Array.from(document.querySelectorAll('#peelGroup button.active'))
                .map(b => b.innerText);
            const unique = Array.from(new Set(selected));

            // 既存 submitForm 互換：読点で結合（空なら ""）
            peelValue = unique.length ? unique.join('、') : '';

            // 配列で使いたい場合はこちら
            window.peelValues = unique;
        }

        // 嫌だった事（複数選択可）
        function selectDislike(el) {
            // ON/OFF 切替
            el.classList.toggle('active');

            // 選択中ラベルを収集 → 重複排除
            const selected = Array.from(document.querySelectorAll('#dislikeGroup button.active'))
                .map(b => b.innerText);
            const unique = Array.from(new Set(selected));

            // 既存 submitForm 互換：読点で結合（空なら ""）
            dislikeValue = unique.length ? unique.join('、') : '';

            // 配列で使いたい場合
            window.dislikeValues = unique;
        }

        // 手の使い方（複数選択可）
        function selectHandUsage(el) {
            // クリック要素のON/OFF
            el.classList.toggle('active');

            // 選択中ラベルを収集 → 重複排除
            const selected = Array.from(document.querySelectorAll('#handUsageGroup button.active'))
                .map(b => b.innerText);
            const unique = Array.from(new Set(selected));

            // 既存 submitForm 互換：読点で結合（空なら ""）
            handUsageValue = unique.length ? unique.join('、') : '';

            // 配列で使いたい場合はこちら
            window.handUsageValues = unique;
        }

        // 仕事OK範囲
        function selectWorkScope(el) {
            setActiveSingle('#workScopeGroup', el);
            workScopeValue = el.innerText;
        }

        // 目的（複数選択可）
        function selectPurpose(el) {
            // ON/OFF 切替
            el.classList.toggle('active');

            // 選択中ラベルを収集 → 重複排除
            const selected = Array.from(document.querySelectorAll('#purposeGroup button.active'))
                .map(b => b.innerText);
            const unique = Array.from(new Set(selected));

            // 既存 submitForm 互換：読点で結合（空なら ""）
            purposeValue = unique.length ? unique.join('、') : '';

            // 配列で使いたい場合
            window.purposeValues = unique;
        }

        // 興味メニュー（複数選択可）
        function selectInterest(el) {
            // クリック要素のON/OFF
            el.classList.toggle('active');

            // 選択中ラベルを収集 → 重複排除
            const selected = Array.from(document.querySelectorAll('#interestGroup button.active'))
                .map(b => b.innerText);
            const unique = Array.from(new Set(selected));

            // 既存 submitForm 互換：読点で結合（空なら ""）
            interestValue = unique.length ? unique.join('、') : '';

            // 配列で扱いたい場合はこちら
            window.interestValues = unique;
        }

        // 喫煙追質問
        function selectSmoking(el) {
            setActiveSingle('#smokingGroup', el);
            smokingValue = el.innerText;
        }


// タバコ：はい/いいえ（単一選択 ＋ 追質問の表示切替）
function selecttabako(el) {
  setActiveSingle('#tabakoGroup', el);
  tabakoValue = el.innerText;

  const follow = document.getElementById('tabakoFollow');
  const subBtns = document.querySelectorAll('#tabakodottiGroup button');

  if (el.id === 'tabakoYes') {
    // 追質問を表示
    follow.style.display = 'block';
  } else {
    // 非表示にして選択リセット
    follow.style.display = 'none';
    subBtns.forEach(b => b.classList.remove('active'));
    tabakodottiValue = '';
  }
}

// 追質問：紙/電子（複数選択可）
function selecttabakodotti(el) {
  // 押されたボタンのON/OFF
  el.classList.toggle('active');

  // アクティブなボタンのラベルを収集 → 重複排除
  const selected = Array.from(document.querySelectorAll('#tabakodottiGroup button.active'))
    .map(b => b.innerText);
  const unique = Array.from(new Set(selected));

  // 既存 submitForm 互換：読点で結合（空なら ""）
  tabakodottiValue = unique.length ? unique.join('、') : '';

  // 配列で扱いたい場合はこちらを参照
  window.tabakodottiValues = unique;
}

        // アレルギー
        function selectAllergy(el) {
            setActiveSingle('#allergyGroup', el);
            allergyValue = el.innerText;
            const wrap = document.getElementById('allergyOtherWrap');
            const input = document.getElementById('allergyOtherInput');
            if (el.id === 'allergyYes') {
                wrap.style.display = 'block';
                allergyDetail = input.value.trim();
                input.oninput = () => allergyDetail = input.value.trim();
            } else {
                wrap.style.display = 'none';
                input.value = '';
                allergyDetail = '';
            }
        }

function submitForm() {
  // ===== テキスト入力（既存IDをそのまま利用）=====
  const nameKanji = (document.getElementById('message')?.value || '').trim();   // お名前（漢字）
  const nameKana  = (document.getElementById('message2')?.value || '').trim();  // お名前（フリガナ）
  const birthYmd  = (document.getElementById('message3')?.value || '').trim();  // 誕生日（西暦）
  const tel       = (document.getElementById('message4')?.value || '').trim();  // 電話番号
  const address   = (document.getElementById('message5')?.value || '').trim();  // ご住所
  const iro   = (document.getElementById('message6')?.value || '').trim();  // ご住所
  const note = (document.querySelector('textarea[placeholder="メッセージを入力してください"]')?.value || '').trim(); // 備考

  // ===== ボタン選択の値（selectXXX 内で更新される想定）=====
  // chanceValue, reasonValues[], jobValue, hobbyValue, nailsValue, holdValue,
  // fragileFingerValue, peelValue, dislikeValue, handUsageValue, workScopeValue,
  // purposeValue, interestValue, allergyValue, allergyDetail, reasonReferralName
  // ▼ たばこ関連（今回追加分）
  // tabakoValue（吸う/吸わない）, tabakodottiValue（紙タバコ/電子タバコ）

  // ===== 必須チェック =====
  // テキスト
  if (!nameKanji) return alert('「お名前（漢字）」を入力してください。');
  if (!nameKana)  return alert('「お名前（フリガナ）」を入力してください。');
  if (!birthYmd)  return alert('「誕生日（西暦）」を入力してください。');
  if (!tel)       return alert('「電話番号」を入力してください。');
  if (!address)   return alert('「ご住所」を入力してください。');

  // ボタン（ラベルの必須に合わせて）
  if (!chanceValue)        return alert('「施術中」のご希望をお選びください。');
  if (!reasonValues.length)return alert('「当店を選んでくださった理由」をお選びください。');
  if (!hobbyValue)         return alert('「趣味」をお選びください。');
  if (!nailsValue)         return alert('「爪・手足の状態」で該当するものをお選びください。');
  if (!holdValue)          return alert('「普段のネイルの持ち」をお選びください。');
  if (!fragileFingerValue) return alert('「取れやすい爪」をお選びください。');
  if (!peelValue)          return alert('「取れ方」をお選びください。');
  if (!dislikeValue)       return alert('「今までのサロンで嫌だった事」をお選びください。');
  if (!handUsageValue)     return alert('「手の使い方、指先の使用頻度」をお選びください。');
  if (!workScopeValue)     return alert('「お仕事でOKな範囲」をお選びください。');
  if (!purposeValue)       return alert('「ネイルをすることの目的・得たいこと」をお選びください。');
  if (!interestValue)      return alert('「興味のあるメニュー」をお選びください。');
  if (!allergyValue)       return alert('「アレルギーはありますか？」をお選びください。');

  // 追加必須：ご紹介/アレルギー詳細
  const pickedReferral = reasonValues.some(v => v.startsWith('ご紹介'));
  if (pickedReferral && !reasonReferralName) {
    return alert('ご紹介を選ばれた場合は「ご紹介者様のお名前」を入力してください。');
  }
  if (allergyValue === 'ある' && !allergyDetail) {
    return alert('アレルギーの内容をご入力ください。');
  }

  // ▼▼ ここから たばこ関連の必須チェックを追加 ▼▼
  if (!tabakoValue) {
    return alert('「タバコは吸われますか？」をお選びください。');
  }
  if (tabakoValue === '吸う' && !tabakodottiValue) {
    return alert('「紙タバコ」または「電子タバコ」をお選びください。');
  }
  // ▲▲ たばこ関連 ここまで ▲▲

  // ===== 整形（箇条書きなど）=====
  const reasonLines = reasonValues.map(v => `・${v}`).join('\n');

  // ===== 送信用オブジェクト（必要に応じてGAS連携にも流用可）=====
  const formData = {
    nameKanji,
    nameKana,
    birthYmd,
    tel,
    address,
    iro,
    chanceValue,
    reasonValues,
    jobValue,                 // 任意
    hobbyValue,
    nailsValue,
    holdValue,
    fragileFingerValue,
    peelValue,
    dislikeValue,
    handUsageValue,
    workScopeValue,
    purposeValue,
    interestValue,
    // ▼ たばこ関連（今回追加）
    tabakoValue,              // 吸う / 吸わない
    tabakodottiValue,         // 紙タバコ / 電子タバコ（吸う時のみ有効）
    // ▲ たばこ関連
    allergyValue,
    allergyDetail,            // 「ある」のときのみ有効
    note,
  };

  // ===== LIFFで送信（テキスト整形）=====
  const tabakoLine =
    tabakoValue === '吸う'
      ? `【タバコ】\n・${tabakoValue}（${tabakodottiValue}）\n`
      : `【タバコ】\n・${tabakoValue}\n`;

  const msg =
`≪アンケート≫

【お名前（漢字）】\n・${nameKanji}
【お名前（フリガナ）】\n・${nameKana}
【誕生日（西暦）】\n・${birthYmd}
【電話番号】\n・${tel}
【ご住所】\n・${address}

【施術中のご希望】\n・${chanceValue}
【当店を選んだ理由】\n${reasonLines}
${jobValue ? `\n【職業】\n・${jobValue}\n` : ''}【趣味】\n・${hobbyValue}
【爪・手足の状態】\n・${nailsValue}
【普段のネイルの持ち】\n・${holdValue}
【取れやすい爪】\n・${fragileFingerValue}
【取れ方】\n・${peelValue}
【手の使い方/指先の使用頻度】\n・${handUsageValue}
【今までのサロンで嫌だった事】\n・${dislikeValue}
【お仕事でOKな範囲】\n・${workScopeValue}
【好きな色、やってみたい色】\n・${iro}
【ネイルの目的】\n・${purposeValue}
【興味のあるメニュー】\n・${interestValue}
${tabakoLine}【アレルギー】\n・${allergyValue}${allergyDetail ? `（${allergyDetail}）` : ''}
${note ? `\n【備考】\n・${note}` : ''}`;

  // LIFFログイン状態の確認
  if (typeof liff !== 'undefined' && liff.isLoggedIn && !liff.isLoggedIn()) {
    liff.login();
    return;
  }

  liff.sendMessages([{ type: 'text', text: msg }])
    .then(() => {
      alert('ご記入ありがとうございます。「OK」をタップしてください。');
      if (liff.closeWindow) liff.closeWindow();
    })
    .catch(err => {
      console.error('メッセージ送信に失敗しました:', err);
      alert('送信に失敗しました。通信環境をご確認の上、もう一度お試しください。');
    });
}

        (function initBirthdayPicker() {
            const yearSel = document.getElementById('birthYear');
            const monthSel = document.getElementById('birthMonth');
            const daySel = document.getElementById('birthDay');
            const hidden = document.getElementById('message3'); // ←既存submitForm互換

            if (!yearSel || !monthSel || !daySel || !hidden) return;

            // 年の候補（1900年〜今年）
            const thisYear = new Date().getFullYear();
            for (let y = thisYear; y >= 1900; y--) {
                const opt = document.createElement('option');
                opt.value = String(y);
                opt.textContent = `${y}`;
                yearSel.appendChild(opt);
            }

            // 月の候補（1〜12）
            for (let m = 1; m <= 12; m++) {
                const opt = document.createElement('option');
                opt.value = String(m).padStart(2, '0');
                opt.textContent = `${m}`;
                monthSel.appendChild(opt);
            }

            function daysInMonth(year, month) {
                // month: "01"〜"12"
                return new Date(Number(year), Number(month), 0).getDate();
            }

            function updateDays() {
                const y = yearSel.value;
                const m = monthSel.value;
                const selected = daySel.value; // 以前の選択を覚えておく
                daySel.innerHTML = '<option value="">日</option>';

                if (!y || !m) { syncHidden(); return; }

                const dmax = daysInMonth(y, m);
                for (let d = 1; d <= dmax; d++) {
                    const v = String(d).padStart(2, '0');
                    const opt = document.createElement('option');
                    opt.value = v;
                    opt.textContent = `${d}`;
                    daySel.appendChild(opt);
                }
                // 以前の選択が生きていれば復元（超過したら未選択）
                if (selected) {
                    const exists = Array.from(daySel.options).some(o => o.value === selected);
                    daySel.value = exists ? selected : '';
                }
                syncHidden();
            }

            function syncHidden() {
                const y = yearSel.value;
                const m = monthSel.value;
                const d = daySel.value;
                hidden.value = (y && m && d) ? `${y}年${m}月${d}日` : '';
            }

            // 既存値（復帰表示用）：YYYY-MM-DD を各セレクトへ展開
            if (hidden.value && /^\d{4}-\d{2}-\d{2}$/.test(hidden.value)) {
                const [yy, mm, dd] = hidden.value.split('-');
                yearSel.value = yy;
                monthSel.value = mm;
                updateDays();
                daySel.value = dd;
                syncHidden();
            } else {
                // 初期化
                updateDays();
            }

            yearSel.addEventListener('change', updateDays);
            monthSel.addEventListener('change', updateDays);
            daySel.addEventListener('change', syncHidden);
        })();

    </script>
</body>

</html>
