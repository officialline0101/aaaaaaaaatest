<!DOCTYPE html>
<html>
<head>
  <title>画像アップロード</title>
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
</head>
<body>
  <h2>画像をアップロード</h2>
  <input type="file" accept="image/*" id="imageInput" />
  <button onclick="uploadImage()">送信</button>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbze7F_GY4LnOzxoPMO9XAOdAxlGmeBCzYhS_Kry_ySGD5eZ4OUEndcrVjsfVnF5UIeirg/exec';

    async function uploadImage() {
      await liff.init({ liffId: "2005254357-zKma9BZk" });

      const fileInput = document.getElementById("imageInput");
      const file = fileInput.files[0];
      if (!file) {
        alert("画像を選択してください");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const base64Data = e.target.result.split(",")[1];

        liff.getProfile().then(profile => {
          liff.getIDToken(); // optional

          liff.getContext().then(ctx => {
            const replyToken = ctx.extra?.replyToken; // LIFF v2.1で取得可能な場合のみ
            const form = new FormData();
            form.append("image", base64Data);
            form.append("type", file.type);
            form.append("replyToken", replyToken || ""); // 空でもOK（開発時）

            fetch(GAS_URL, {
              method: "POST",
              body: form
            }).then(res => res.text())
              .then(txt => alert("アップロード完了: " + txt))
              .catch(err => alert("送信エラー: " + err));
          });
        });
      };
      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
