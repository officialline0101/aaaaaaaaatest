<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ </title>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        /* --- ã‚«ãƒ©ãƒ¼ãƒ»åŸºæœ¬è¨­å®š --- */
        :root {
            /* ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼: å„ªã—ã„é»„è‰² (å°‘ã—æ¿ƒã„ã‚ã®ãƒã‚¹ã‚¿ãƒ¼ãƒ‰ã‚¤ã‚¨ãƒ­ãƒ¼ã§è¦–èªæ€§ã‚’ç¢ºä¿) */
            /* å…ƒ: #1b2a4e (Navy) */
            --primary-color: #f0c645;

            /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ: å„ªã—ã„æ°´è‰² */
            /* å…ƒ: #c5a059 (Gold) */
            --accent-color: #7dcbf5;

            /* ãƒ†ã‚­ã‚¹ãƒˆè‰²ï¼ˆãƒ¡ã‚¤ãƒ³èƒŒæ™¯ä¸Šã®æ–‡å­—è‰²ï¼‰: ã“ã’èŒ¶è‰² (é»„è‰²èƒŒæ™¯ã§ã‚‚èª­ã¿ã‚„ã™ã) */
            --text-on-primary: #5d4a35;

            /* èƒŒæ™¯è‰²: è–„ã„ã‚¯ãƒªãƒ¼ãƒ è‰² */
            --bg-color: #fffef9;

            /* ãƒ†ã‚­ã‚¹ãƒˆè‰²: é€šå¸¸ã®é»’ã«è¿‘ã„ã‚°ãƒ¬ãƒ¼ */
            --text-color: #333333;

            /* ç™½ */
            --white: #ffffff;
            
            /* å¿…é ˆãƒãƒƒã‚¸èƒŒæ™¯ */
            --required-bg: #ff6b6b;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', 'Poppins', sans-serif;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding-top: 10px;
            padding-bottom: 40px;
            color: var(--text-color);
            overflow-x: hidden;
        }

        /* --- ã‚³ãƒ³ãƒ†ãƒŠ --- */
        .container {
            background-color: var(--white);
            border-radius: 4px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.05); /* å½±ã‚’å°‘ã—è–„ã */
            width: 96%;
            max-width: 500px;
            padding: 25px;
            margin: 0 auto;
            border-top: 4px solid var(--accent-color);
        }

        /* --- è¦‹å‡ºã— (H1) --- */
        h1 {
            background: var(--primary-color);
            color: var(--text-on-primary); /* é»„è‰²èƒŒæ™¯ãªã®ã§æ¿ƒã„æ–‡å­—ã«å¤‰æ›´ */
            padding: 20px 15px;
            margin: -25px -25px 30px -25px;
            font-size: 22px;
            font-weight: 700;
            text-align: center;
            letter-spacing: 1px;
            position: relative;
        }

        /* --- ãƒ©ãƒ™ãƒ«å…±é€šã‚¹ã‚¿ã‚¤ãƒ« --- */
        .label,
        .labeltyuuou {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 8px 15px;
            font-weight: 700;
            background-color: transparent;
            color: var(--text-color); /* é»„è‰²ã ã¨èª­ã¿ã«ãã„ãŸã‚é€šå¸¸è‰²ã«å¤‰æ›´ */
            font-size: 16px;
            border-bottom: 2px solid var(--primary-color);
            border-left: 6px solid var(--accent-color);
            line-height: 1.4;
        }

        /* ä¸­å¤®æƒãˆç”¨ãƒ©ãƒ™ãƒ«ã®å¾®èª¿æ•´ãŒå¿…è¦ãªå ´åˆ */
        .labeltyuuou {
            justify-content: space-between;
        }

        .highlight-text {
            /* å¿…è¦ã«å¿œã˜ã¦è£…é£¾ */
        }

        /* å¿…é ˆãƒãƒ¼ã‚¯ */
        .required {
            font-size: 11px;
            margin-left: auto;
            background-color: var(--required-bg);
            /* èµ¤è‰²ã«å¤‰æ›´ */
            color: var(--white);
            padding: 2px 6px;
            border-radius: 2px;
            font-weight: normal;
            vertical-align: middle;
        }

        /* --- ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›è¦ç´  --- */
        input[type="text"],
        input[type="tel"],
        textarea {
            width: 100%;
            padding: 14px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 2px;
            font-size: 16px;
            background-color: #fafafa;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus,
        textarea:focus {
            border-color: var(--primary-color);
            background-color: var(--white);
            outline: none;
            box-shadow: 0 0 0 1px var(--primary-color);
        }

        /* --- ãƒœã‚¿ãƒ³é¸æŠã‚¨ãƒªã‚¢ (ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ) --- */
        .visit-buttons,
        .symptoms,
        .menu-sections,
        .irradiations {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
        }

        .visit-buttons button,
        .symptoms button,
        .menu-sections button,
        .irradiations button {
            flex: 1 1 45%;
            /* 2åˆ—é…ç½® */
            padding: 14px 10px;
            border: 1px solid #ccc;
            border-radius: 2px;
            background-color: var(--white);
            color: var(--text-color);
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.2s;
            text-align: center;
        }

        /* ãƒ›ãƒãƒ¼æ™‚ */
        .visit-buttons button:hover,
        .symptoms button:hover,
        .menu-sections button:hover,
        .irradiations button:hover {
            border-color: var(--primary-color);
            background-color: #fffdf5;
        }

        /* é¸æŠï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰æ™‚ */
        .visit-buttons button.active,
        .symptoms button.active,
        .menu-sections button.active,
        .irradiations button.active {
            background-color: var(--primary-color);
            color: var(--text-on-primary); /* é»„è‰²èƒŒæ™¯ç”¨æ–‡å­—è‰² */
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(240, 198, 69, 0.4);
            outline: none;
        }

        /* å‰å›ã¨åŒã˜ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */
        .repeat-booking-wrapper {
            text-align: center;
            margin: 20px 0;
        }

        #repeatBookingButton {
            background-color: #f7f7f7;
            color: #000000;
            border: 1px solid #000000;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }

        #repeatBookingButton:hover {
            background-color: #f1f1f1;
        }

        /* --- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ (ãƒ‡ã‚¶ã‚¤ãƒ³æ”¹ä¿®ç‰ˆ) --- */
        .calendar-container {
            margin-bottom: 30px;
            border: none;
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--white);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            display: none;
            /* åˆæœŸéè¡¨ç¤º */
        }

        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæœˆè¡¨ç¤ºéƒ¨åˆ†ï¼‰ */
        .calendar-header {
            background-color: var(--primary-color);
            color: var(--text-on-primary); /* é»„è‰²èƒŒæ™¯ç”¨æ–‡å­—è‰² */
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* æ“ä½œãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
        .calendar-controls {
            background-color: #fdfdfd;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            border-bottom: 1px solid #eee;
        }

        .control-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .control-label {
            font-size: 12px;
            color: #666;
            font-weight: bold;
        }

        .month-button,
        .week-button {
            padding: 6px 16px;
            background-color: var(--white);
            color: var(--text-color); /* è¦–èªæ€§ã®ãŸã‚é€šå¸¸è‰² */
            border: 1px solid var(--primary-color);
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .month-button:hover,
        .week-button:hover {
            background-color: var(--primary-color);
            color: var(--text-on-primary);
        }

        /* --- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ (ã€‡âœ•è¦–èªæ€§é‡è¦–ç‰ˆ) --- */
        .calendar-container {
            margin-bottom: 20px;
            background-color: transparent;
            display: none;
            /* åˆæœŸéè¡¨ç¤º */
        }

        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæœˆè¡¨ç¤ºï¼‰ã®èª¿æ•´ */
        .calendar-header {
            background: var(--primary-color);
            color: var(--text-on-primary); /* é»„è‰²èƒŒæ™¯ç”¨æ–‡å­—è‰² */
            padding: 15px 12px;
            /* ä¸Šä¸‹ã®ä½™ç™½ã‚’å°‘ã—å¢—ã‚„ã™ */
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            /* ã»ã‚“ã®ã‚Šå½±ã‚’ã¤ã‘ã¦ç«‹ä½“æ„Ÿ */
        }

        /* å¹´æœˆã®æ–‡å­—ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .current-month {
            font-family: 'Poppins', 'Noto Sans JP', sans-serif;
            /* æ•°å­—ã‚’æ¬§æ–‡ãƒ•ã‚©ãƒ³ãƒˆã§ç¾ã—ã */
            font-size: 20px;
            /* ã‚µã‚¤ã‚ºã‚’å°‘ã—å¤§ãã */
            font-weight: 600;
            /* ç¨‹ã‚ˆã„å¤ªã• */
            letter-spacing: 0.15em;
            /* æ–‡å­—ã®é–“éš”ã‚’åºƒã’ã¦é«˜ç´šæ„Ÿã‚’æ¼”å‡º */
            border-bottom: 2px solid var(--white);
            /* ç™½è‰²ã®ä¸‹ç·šã§å„ªã—ã */
            padding-bottom: 4px;
            /* æ–‡å­—ã¨ä¸‹ç·šã®è·é›¢ */
            margin-bottom: -2px;
            /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œé˜²æ­¢ */
        }

        /* æ“ä½œãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
        .calendar-controls {
            background-color: #fff;
            padding: 10px;
            border: 1px solid #888;
            border-top: none;
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .control-group {
            display: flex;
            gap: 5px;
        }

        .month-button,
        .week-button {
            padding: 5px 12px;
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            font-weight: bold;
        }

        .month-button:hover,
        .week-button:hover {
            background-color: #e0e0e0;
        }

        /* å‡¡ä¾‹ï¼ˆã€‡âœ•ã®èª¬æ˜ï¼‰ */
        .calendar-legend {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            padding: 8px 10px;
            background: #fff;
            border-left: 1px solid #888;
            border-right: 1px solid #888;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-marker {
            width: 14px;
            height: 14px;
            border-radius: 2px;
            display: inline-block;
        }

        .marker-ok {
            background-color: #fff;
            border: 1px solid var(--primary-color);
            position: relative;
        }

        .marker-ok::after {
            content: "ã€‡";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            color: var(--primary-color);
            line-height: 1;
        }

        .marker-ng {
            background-color: #e0e0e0;
            color: #999;
            text-align: center;
            line-height: 14px;
            font-size: 10px;
        }

        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“ */
        .calendar {
            width: 100%;
            overflow-x: auto;
            background: #888;
            border-top: none;
            border-radius: 0 0 6px 6px;
        }

        .calendar table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            min-width: 320px;
        }

        .calendar th {
            background-color: #f9f9f9;
            color: #333;
            font-weight: bold;
            padding: 8px 0;
            font-size: 12px;
            border-bottom: 2px solid #888;
            border-right: 1px solid #888;
        }

        /* æœ€åˆã®åˆ—ï¼ˆæ™‚é–“è»¸ï¼‰ã®èª¿æ•´ */
        .calendar th:first-child,
        .calendar td:first-child {
            width: 50px;
            background-color: #f9f9f9;
            font-weight: bold;
            font-size: 11px;
            color: #555;
        }

        /* ã‚»ãƒ«å…±é€šè¨­å®š */
        .calendar td {
            padding: 10px 0;
            text-align: center;
            border: 1px solid #888;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            height: 40px;
            /* ã‚¿ãƒƒãƒ—ã—ã‚„ã™ã„é«˜ã• */
            vertical-align: middle;
            position: relative;
        }

        /* --- äºˆç´„å¯èƒ½ (ã€‡) ã®ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        .calendar td {
            background-color: #fff;
            color: #ff0909;
            /* ã€‡ã®è‰² */
            font-weight: bold;
        }

        /* ã‚‚ã—JSã§ãƒ†ã‚­ã‚¹ãƒˆãŒå…¥ã‚‰ãªã„å ´åˆã€å¼·åˆ¶çš„ã«ã€‡ã‚’è¡¨ç¤ºã•ã›ã‚‹CSS (å¿…è¦ã«å¿œã˜ã¦æœ‰åŠ¹åŒ–) */
        /* .calendar td:not(.unavailable):not(:first-child):empty::after {
            content: "ã€‡";
            color: var(--accent-color);
        } */

        /* ãƒ›ãƒãƒ¼æ™‚ */
        .calendar td:not(.unavailable):not(:first-child):hover {
            background-color: #fffcf0;
            /* è–„ã„é»„è‰² */
            border: 1px solid var(--primary-color);
        }

        /* --- äºˆç´„ä¸å¯ (âœ•) ã®ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆæš—ãå¼·èª¿ï¼‰ --- */
        .calendar td.unavailable {
            background-color: #a0a0a0;
            /* ã‹ãªã‚Šæ¿ƒã„ã‚°ãƒ¬ãƒ¼ã«å¤‰æ›´ */
            color: #ffffff;
            /* æ–‡å­—è‰²ã‚’è–„ãã—ã¦ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚’ä¸‹ã’ã‚‹ */
            cursor: not-allowed;
            pointer-events: none;
            font-weight: normal;
        }

        /* âœ•å°ã®æ–œç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚æš—ã */
        .calendar td.unavailable:not(:first-child) {
            background-image: linear-gradient(45deg, rgba(0, 0, 0, 0.05) 25%, transparent 25%, transparent 50%, rgba(0, 0, 0, 0.05) 50%, rgba(0, 0, 0, 0.05) 75%, transparent 75%, transparent);
            background-size: 8px 8px;
        }

        /* --- é¸æŠä¸­ ã®ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        .calendar td.selected {
            background-color: var(--primary-color) !important;
            color: var(--text-on-primary) !important; /* é»„è‰²èƒŒæ™¯ç”¨æ–‡å­—è‰² */
            border: 1px solid var(--primary-color);
            position: relative;
            z-index: 5;
            box-shadow: 0 0 0 2px rgba(240, 75, 69, 0.4);
        }

        /* é¸æŠä¸­ã®ã‚»ãƒ«ã«ã¯ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ãªã©ã‚’å‡ºã™å ´åˆ */
        .calendar td.selected::after {
            content: "";
            display: block;
            font-size: 10px;
            line-height: 1;
            margin-top: 2px;
        }

        /* --- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ï¼ˆå¤‰æ›´ãªã—ï¼‰ --- */
        .loading-spinner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 40px;
            border-radius: 10px;
            z-index: 2000;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            margin: 0 auto;
        }

        .loading-text {
            margin-top: 20px;
            font-size: 15px;
            font-weight: bold;
            color: #ffffff;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* --- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¬„ & ç¢ºèªã‚¨ãƒªã‚¢ --- */
        .info-text {
            font-size: 13px;
            color: #666;
            text-align: center;
            margin-bottom: 10px;
        }

/* --- æ´—ç·´ã•ã‚ŒãŸã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç¢ºèªã‚«ãƒ¼ãƒ‰ --- */
        #displayInfo {
            background-color: #fff;
            border: 1px solid #e1e4e8;
            border-left: 4px solid var(--accent-color);
            border-radius: 6px;
            padding: 15px 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            position: relative;
        }

        /* æ—¥æ™‚ã‚¨ãƒªã‚¢ */
        .c-date-area {
            display: flex;
            align-items: baseline;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px dashed #eee;
        }

        .c-date-label {
            font-size: 11px;
            font-weight: bold;
            color: var(--text-color);
            background: #eef8ff; /* è–„ã„æ°´è‰² */
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid var(--accent-color);
        }

        .c-date-val {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            letter-spacing: 0.02em;
        }

        /* ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚¨ãƒªã‚¢ */
        .c-user-grid {
            display: grid;
            grid-template-columns: 1fr auto; /* 2åˆ— */
            gap: 5px 20px;
            align-items: center;
            margin-bottom: 12px; /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ã®é–“éš” */
        }

        .c-user-item {
            display: flex;
            flex-direction: column;
        }

        .c-user-label {
            font-size: 10px;
            color: #999;
            margin-bottom: 2px;
        }

        .c-user-val {
            font-size: 14px;
            color: #444;
            font-weight: 600;
        }

        /* --- è¿½åŠ ï¼šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ --- */
        .c-menu-area {
            background-color: #fffdf5; /* è–„ã„é»„è‰² */
            padding: 10px 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            position: relative;
        }

        .c-menu-label {
            font-size: 10px;
            color: #888;
            font-weight: bold;
            display: block;
            margin-bottom: 4px;
        }

        .c-menu-val {
            font-size: 14px;
            font-weight: bold;
            color: #444; /* æ–‡å­—è‰²å¤‰æ›´ */
            line-height: 1.4;
        }

        /* åˆè¨ˆé‡‘é¡ã‚¨ãƒªã‚¢ */
        .c-price-area {
            padding-top: 10px;
            border-top: 1px solid #f5f5f5;
            display: flex;
            justify-content: flex-end;
            align-items: baseline;
            gap: 8px;
        }

        .c-price-label {
            font-size: 11px;
            color: #666;
            font-weight: bold;
        }

        .c-price-val {
            font-size: 22px;
            font-weight: 800;
            color: #e6b422; /* ã‚´ãƒ¼ãƒ«ãƒ‰ç³»é»„è‰² */
            line-height: 1;
        }

        /* ä¿®æ­£ãƒªãƒ³ã‚¯ */
        .c-edit-link {
            font-size: 10px;
            color: #bbb;
            text-decoration: underline;
            cursor: pointer;
            margin-left: auto;
            transition: 0.2s;
        }
        .c-edit-link:hover {
            color: var(--primary-color);
        }
        
        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¿®æ­£ç”¨ãƒªãƒ³ã‚¯ï¼ˆçµ¶å¯¾é…ç½®ã§å³ä¸Šã«ï¼‰ */
        .c-menu-edit {
            position: absolute;
            top: 10px;
            right: 12px;
        }

        /* --- äºˆç´„å®Ÿè¡Œãƒœã‚¿ãƒ³ --- */
        .submit-button {
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-color), #e3b04b);
            color: var(--text-on-primary); /* é»„è‰²èƒŒæ™¯ç”¨æ–‡å­—è‰² */
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(240, 198, 69, 0.3);
            transition: transform 0.1s, box-shadow 0.3s;
            border-bottom: 4px solid #dbaa30; /* å°‘ã—æ¿ƒã„é»„è‰² */
        }

        .submit-button:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
            box-shadow: none;
        }

        /* --- å³ç«¯ã®è¿½å¾“ãƒŠãƒ“ --- */
        .side-nav {
            position: fixed;
            right: 0;
            top: 82%;
            transform: translateY(50%);
            background: var(--primary-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 4px;
            border-radius: 8px 0 0 8px;
            z-index: 1000;
            width: 40px;
            box-shadow: -2px 2px 5px rgba(0, 0, 0, 0.1);
        }

        .side-nav a {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-on-primary); /* æ–‡å­—è‰²å¤‰æ›´ */
            text-decoration: none;
            font-size: 10px;
            margin: 0;
            width: 100%;
            height: 40px;
            text-align: center;
        }

        .side-nav a span {
            font-size: 32px;
            font-weight: bold;
            display: block;
            line-height: 1;
            margin-bottom: 2px;
        }

        .side-nav a i {
            font-size: 16px;
        }

        /* --- ã‚¹ãƒãƒ›å¯¾å¿œ (ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªã¾ã¨ã‚) --- */
        @media (max-width: 600px) {
            .container {
                width: 100%;
                padding: 20px 15px;
                box-shadow: none;
                border-radius: 0;
            }

            h1 {
                border-radius: 0;
                margin: -20px -15px 25px -15px;
            }

            .label,
            .labeltyuuou {
                font-size: 15px;
            }

            .visit-buttons button,
            .symptoms button,
            .menu-sections button,
            .irradiations button {
                padding: 12px 5px;
                font-size: 14px;
            }

            .side-nav {
                width: 35px;
            }
        }

        /* --- æ²»ç™‚å†…å®¹ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ (ãƒ‡ã‚¶ã‚¤ãƒ³æ”¹ä¿®ç‰ˆ) --- */
        #treatment-text {
            display: none;
            position: absolute;
            z-index: 1500;
            background-color: var(--white);
            /* èƒŒæ™¯ã‚’ç™½ã«ã—ã¦ã‚¯ãƒƒã‚­ãƒªã•ã›ã‚‹ */
            width: 300px;
            /* å¹…ã‚’å›ºå®šã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å®‰å®šã•ã›ã‚‹ */
            max-width: 90vw;
            padding: 0;
            /* å†…å´ã®ä½™ç™½ã¯å€‹åˆ¥ã«è¨­å®š */
            border-radius: 8px;
            /* æ ç·šã‚’å»ƒæ­¢ã—ã€å½±ã‚’å¼·ã‚ã«ã—ã¦æµ®ã‹ã³ä¸ŠãŒã‚‰ã›ã‚‹ */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-top: 5px solid var(--accent-color);
            /* ä¸Šéƒ¨ã«ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
            font-family: 'Noto Sans JP', sans-serif;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
        }

        /* é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ */
        #treatment-text .treatment-close {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 30px;
            height: 30px;
            border: none;
            background: #f0f0f0;
            color: #999;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 10;
        }

        #treatment-text .treatment-close:hover {
            background-color: var(--primary-color);
            color: var(--text-on-primary);
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .treatment-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* æ™‚é–“è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .t-time-row {
            display: flex;
            align-items: center;
            font-size: 14px;
            font-weight: bold;
            color: var(--text-color); /* é€šå¸¸è‰²ã«å¤‰æ›´ */
            border-bottom: 1px dashed #eee;
            padding-bottom: 8px;
        }

        .t-icon {
            margin-right: 6px;
            color: var(--primary-color); /* ã‚¢ã‚¤ã‚³ãƒ³ã‚’é»„è‰²ã« */
        }

        /* æ–™é‡‘è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆä¸€ç•ªç›®ç«‹ãŸã›ã‚‹ï¼‰ */
        .t-price-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            background: #fdfdfd;
        }

        .t-price-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .t-price-val {
            font-size: 24px;
            font-weight: 800;
            color: #e6b422; /* ã‚´ãƒ¼ãƒ«ãƒ‰ */
            /* é‡‘è‰²ã§å¼·èª¿ */
            line-height: 1;
            letter-spacing: 0.05em;
        }

        .t-price-sub {
            font-size: 11px;
            color: #999;
            text-align: right;
            margin-top: 2px;
        }

        /* æ³¨æ„æ›¸ã */
        .t-note {
            font-size: 11px;
            color: #888;
            background-color: #fffef9;
            padding: 8px;
            border-radius: 4px;
            line-height: 1.4;
        }

        /* è©³ç´°ãƒ†ã‚­ã‚¹ãƒˆ */
        .t-detail {
            font-size: 12px;
            color: #555;
            line-height: 1.6;
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼åï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .t-title-row {
            display: flex;
            align-items: center;
            font-size: 15px;
            font-weight: 700;
            color: var(--text-color); /* é€šå¸¸è‰²ã«å¤‰æ›´ */
            padding-bottom: 6px;
            border-bottom: 1px solid #eee;
        }

        .t-title-row .t-icon {
            margin-right: 6px;
        }

        .t-title {
            letter-spacing: 0.05em;
        }

        /* è©³ç´°ãƒ†ã‚­ã‚¹ãƒˆï¼ˆã¾ã å…¥ã‚Œã¦ãªã‘ã‚Œã°ï¼‰ */
        .t-detail {
            font-size: 12px;
            color: #555;
            line-height: 1.6;
        }


        /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡ */
        .menu-section {
            display: none;
        }

        .menu-section.active {
            display: block;
        }
    </style>
</head>

<body>
    <div class="side-nav" id="sideNav">
        <a href="#section-message">
            <span>â‡©</span>
            <i class="fas fa-comment"></i>
        </a>
    </div>

    <div class="container">
        <h1>æ±å·å£ã‚„ã™æ¥éª¨é™¢<br>äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ 
        </h1>
        <div class="repeat-booking-wrapper">
            <button type="button" id="repeatBookingButton" onclick="applyPreviousSelection()">
                ğŸ” å‰å›ã¨åŒã˜ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§äºˆç´„ã™ã‚‹
            </button>
        </div>

        <div class="label">ãŠå®¢æ§˜å<span class="required">å¿…é ˆ</span></div>

        <input type="text" id="name" placeholder="ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" oninput="saveInput('name')">

        <div class="label">é›»è©±ç•ªå·<span class="required">å¿…é ˆ</span></div>
        <input type="tel" id="phone" placeholder="é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" oninput="saveInput('phone')">

        <div class="label">ã”æ¥åº—å›æ•°<span class="required">å¿…é ˆ</span></div>
        <div class="visit-buttons">
            <button type="button" id="firstVisit" onclick="selectVisit(this)">1å›ç›®</button>
            <button type="button" id="repeatVisit" onclick="selectVisit(this)">2å›ç›®ä»¥é™</button>
        </div>

        <div class="label" id="course">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãŠé¸ã³ãã ã•ã„<span class="required">å¿…é ˆ</span></div>
        <div class="info-text">â€»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã™ã‚‹ã¨<br>ç©ºãçŠ¶æ³ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
        <div class="symptoms">
            <button type="button" onclick="selectSymptom(this, 'treatment1')" data-price="0">è‚©ã“ã‚Šãƒ»è…°ç—›æ•´ä½“</button>
            <button type="button" onclick="selectSymptom(this, 'treatment2')" data-price="0">ã‚¹ãƒãƒ¼ãƒ„æ•´ä½“</button>
            <button type="button" onclick="selectSymptom(this, 'treatment3')" data-price="0">é ­ç—›ãƒ»ã‚ã¾ã„ãƒ»ä¸çœ æ•´ä½“</button>
            <button type="button" onclick="selectSymptom(this, 'treatment4')" data-price="0">æ—¥å¸¸ç”Ÿæ´»ãƒ»ã‚¹ãƒãƒ¼ãƒ„ã«ã‚ˆã‚‹<br>ãŠæ€ªæˆ‘ã®æ²»ç™‚</button>
            <button type="button" onclick="selectSymptom(this, 'treatment5')" data-price="0">QUICKéª¨ç›¤æ•´ä½“</button>
            <button type="button" onclick="selectSymptom(this, 'treatment6')" data-price="0">äº¤é€šäº‹æ•…ã«ã‚ˆã‚‹ãŠæ€ªæˆ‘ã®æ²»ç™‚</button>
        </div>

        <div id="treatment-text"></div>

        <div class="calendar-container">
            <div class="calendar-header">
                <span class="current-month" id="currentMonth">2023å¹´ 10æœˆ</span>
            </div>

            <div class="calendar-controls">
                <div class="control-group">
                    <button class="month-button" onclick="previousmonth()">â—€ å‰æœˆ</button>
                    <button class="month-button" onclick="nextmonth()">ç¿Œæœˆ â–¶</button>
                </div>
                <div class="control-group">
                    <button class="week-button" onclick="previousWeek()">â—€ å‰é€±</button>
                    <button class="week-button" onclick="nextWeek()">ç¿Œé€± â–¶</button>
                </div>
            </div>

            <div class="calendar-legend">
                <div class="legend-item">
                    <span class="legend-marker marker-ok"></span>
                    <span>äºˆç´„å¯</span>
                </div>
                <div class="legend-item">
                    <span class="legend-marker marker-ng">âœ•</span>
                    <span>æº€å¸­</span>
                </div>
            </div>

            <div id="calendar1" class="calendar">
                <table>
                    <thead>
                        <tr id="calendar-header">
                            <th>æ™‚é–“</th>
                            <th>æœˆ</th>
                            <th>ç«</th>
                            <th>æ°´</th>
                            <th>æœ¨</th>
                            <th>é‡‘</th>
                            <th>åœŸ</th>
                            <th>æ—¥</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <div class="loading-text">èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
        </div>

        <div class="labeltyuuou">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸<br>ï¼ˆè³ªå•ç­‰ãŠæ°—è»½ã«ã”è¨˜å…¥ãã ã•ã„ï¼‰</div>
        <textarea id="message" rows="4" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>

        <div class="labeltyuuou">ã”äºˆç´„å†…å®¹</div>
        <div id="displayInfo"></div> <button class="submit-button" onclick="submitForm()" div id="section-message">äºˆç´„ã‚’è¡Œã†</button>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        let visitCount = '';
        let selectedMenu = '';
        let selectedSymptom = [];  // é…åˆ—ã¨ã—ã¦å®šç¾©
        let selectedFullDate = '';
        let currentDate = new Date();
        let availabilityCache = {};
        let irradiationsCount = ''; let totalAmount = 0; // åˆè¨ˆé‡‘é¡ã‚’æ ¼ç´ã™ã‚‹å¤‰æ•°
        let menuPrice = 0; // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ä¾¡æ ¼
        let optionsPrice = 0; // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®åˆè¨ˆä¾¡æ ¼

        // â–¼ è¿½åŠ ï¼šå‰å›ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é©ç”¨ä¸­ã‹ã©ã†ã‹åˆ¤å®šã™ã‚‹ãƒ•ãƒ©ã‚°
        let isApplyingPreviousSelection = false;

        document.addEventListener('DOMContentLoaded', function () {
            liff.init({
                liffId: '2005254357-zKma9BZk'
            }).then(() => {
                console.log('LIFFåˆæœŸåŒ–æˆåŠŸ');
            }).catch((err) => {
                console.log('LIFFåˆæœŸåŒ–å¤±æ•—', err);
            });

            fetchAvailability(currentDate);
        });

        // è¨ªå•å›æ•°ã”ã¨ã®æ™‚é–“è¨­å®š (ä¾‹ï¼šåˆã‚ã¦=20åˆ†ã€2å›ç›®ä»¥é™=15åˆ†)
        let visitTimes = {
            '1å›ç›®': 0,
            '2å›ç›®ä»¥é™': 0
        };

        let selectedVisitTime = 0; // è¨ªå•å›æ•°ã§é¸æŠã•ã‚ŒãŸæ™‚é–“

        // è¨ªå•å›æ•°ã”ã¨ã®æ™‚é–“è¨­å®š (ä¾‹ï¼šåˆã‚ã¦=20åˆ†ã€2å›ç›®ä»¥é™=15åˆ†)
        let irradiationsTimes = {
            'ç¾ç™½ãƒ‘ãƒƒã‚¯ã€ˆ30åˆ†ã€‰': 0
        };

        let selectedirradiationsTime = 0; // è¨ªå•å›æ•°ã§é¸æŠã•ã‚ŒãŸæ™‚é–“

        let menuTimes = {
            'è‚©ã“ã‚Šãƒ»è…°ç—›æ•´ä½“': 60,
            'ã‚¹ãƒãƒ¼ãƒ„æ•´ä½“': 60,
            'é ­ç—›ãƒ»ã‚ã¾ã„ãƒ»ä¸çœ æ•´ä½“': 75,
            'æ—¥å¸¸ç”Ÿæ´»ãƒ»ã‚¹ãƒãƒ¼ãƒ„ã«ã‚ˆã‚‹ãŠæ€ªæˆ‘ã®æ²»ç™‚': 45,
            'QUICKéª¨ç›¤æ•´ä½“': 30,
            'äº¤é€šäº‹æ•…ã«ã‚ˆã‚‹ãŠæ€ªæˆ‘ã®æ²»ç™‚': 45,
            'è‚©ã“ã‚Šãƒ»è…°ç—›æ•´ä½“.': 45,
            'ã‚¹ãƒãƒ¼ãƒ„æ•´ä½“.': 45,
            'é ­ç—›ãƒ»ã‚ã¾ã„ãƒ»ä¸çœ æ•´ä½“.': 60,
            'æ—¥å¸¸ç”Ÿæ´»ãƒ»ã‚¹ãƒãƒ¼ãƒ„ã«ã‚ˆã‚‹ãŠæ€ªæˆ‘ã®æ²»ç™‚.': 30,
            'QUICKéª¨ç›¤æ•´ä½“.': 15,
            'äº¤é€šäº‹æ•…ã«ã‚ˆã‚‹ãŠæ€ªæˆ‘ã®æ²»ç™‚.': 30
        };

        let selectedMenuTime = 0;

        // å…¥åŠ›å†…å®¹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        function saveInput(id) {
            const value = document.getElementById(id).value;
            localStorage.setItem(id, value);
        }

        // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã¨ãã«å‰å›ã®å…¥åŠ›å†…å®¹ã‚’å¾©å…ƒ
        document.addEventListener('DOMContentLoaded', function () {
            const savedName = localStorage.getItem('name');
            const savedPhone = localStorage.getItem('phone');

            if (savedName) document.getElementById('name').value = savedName;
            if (savedPhone) document.getElementById('phone').value = savedPhone;
        });

        // ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        document.querySelectorAll('.side-nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 20,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // é¸æŠã—ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä¿å­˜
        function saveMenuSelection(menuType) {
            localStorage.setItem('selectedMenu', menuType);
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ãŸã¨ãã«ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        function showMenu(menuType) {
            document.querySelectorAll('.menu-section').forEach(section => section.style.display = 'none');
            document.getElementById(menuType).style.display = 'block';
            saveMenuSelection(menuType);
        }

function applyPreviousSelection() {
            // 1. ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨æ¤œè¨¼
            let savedSymptoms = [];
            let savedIrradiations = [];
            
            try {
                const symptomsStr = localStorage.getItem('selectedSymptoms');
                const irradiationsStr = localStorage.getItem('selectedIrradiations');
                
                if (symptomsStr) savedSymptoms = JSON.parse(symptomsStr);
                if (irradiationsStr) savedIrradiations = JSON.parse(irradiationsStr);
            } catch (e) {
                console.error('ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
            }

            // ãƒ‡ãƒ¼ã‚¿ãŒãªã‘ã‚Œã°ã‚¢ãƒ©ãƒ¼ãƒˆ
            if ((!savedSymptoms || savedSymptoms.length === 0) && (!savedIrradiations || savedIrradiations.length === 0)) {
                alert('å‰å›ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }

            // âœ… è‡ªå‹•é©ç”¨ãƒ¢ãƒ¼ãƒ‰ ON
            isApplyingPreviousSelection = true;

            // 2. ã€Œ2å›ç›®ä»¥é™ã€ã‚’è‡ªå‹•é¸æŠ
            // ã€Œå‰å›ã¨åŒã˜ã€ã‚’é¸ã¶ã¨ã„ã†ã“ã¨ã¯ã€å¿…ãšãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ã§ã‚ã‚‹ãŸã‚
            const repeatVisitButton = document.getElementById('repeatVisit');
            if (repeatVisitButton) {
                // æ—¢ã«1å›ç›®ãŒé¸ã°ã‚Œã¦ã„ãŸã‚Šã€ä½•ã‚‚é¸ã°ã‚Œã¦ã„ãªã„å ´åˆã«å¯¾å¿œã™ã‚‹ãŸã‚ã‚¯ãƒªãƒƒã‚¯
                repeatVisitButton.click();
            }

            // 3. ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼/ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä¸€åº¦ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.symptoms button.active').forEach(btn => btn.click());
            document.querySelectorAll('.irradiations button.active').forEach(btn => btn.click());

            // 4. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆç—‡çŠ¶ï¼‰ã®ãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦ã‚¯ãƒªãƒƒã‚¯
            // onclickå±æ€§ã«å«ã¾ã‚Œã‚‹æ–‡å­—åˆ—(treatmentId)ã§ç…§åˆã™ã‚‹
            const symptomButtons = document.querySelectorAll('.symptoms button');
            savedSymptoms.forEach(savedId => {
                // savedId (ä¾‹: "treatment1") ã‚’å«ã‚€ãƒœã‚¿ãƒ³ã‚’æ¢ã™
                for (const btn of symptomButtons) {
                    const onclickAttr = btn.getAttribute('onclick');
                    // ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã¾ã‚ŒãŸIDãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                    if (onclickAttr && onclickAttr.includes(`'${savedId}'`)) {
                        btn.click();
                        break; // è¦‹ã¤ã‹ã£ãŸã‚‰ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹
                    }
                }
            });

            // 5. ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦ã‚¯ãƒªãƒƒã‚¯
            // ã“ã¡ã‚‰ã¯IDå±æ€§ãŒã¤ã„ã¦ã„ã‚‹æƒ³å®š
            savedIrradiations.forEach(savedId => {
                const btn = document.getElementById(savedId);
                if (btn) {
                    btn.click();
                }
            });

            // âœ… è‡ªå‹•é©ç”¨ãƒ¢ãƒ¼ãƒ‰ OFF
            isApplyingPreviousSelection = false;

            // 6. è¡¨ç¤ºã‚’æ›´æ–°ã—ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            updateDisplayInfo();
            
            const calendarEl = document.getElementById('calendar1');
            if (calendarEl) {
                calendarEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

function updateDisplayInfo() {
            const name = document.getElementById('name').value || '-';
            const visitCountText = visitCount ? visitCount : '-';
            
            // é‡‘é¡è¨ˆç®—
            const totalAmountText = 'Â¥' + (menuPrice + optionsPrice).toLocaleString();

            // æ—¥æ™‚æ•´å½¢
            let dateDisplay = '<span style="color:#ccc; font-size:13px;">æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„</span>';
            if (selectedFullDate) {
                let totalMinutes = selectedMenuTime + selectedirradiationsTime + selectedVisitTime;
                let hours = Math.floor(totalMinutes / 60);
                let minutes = totalMinutes % 60;
                let timeText = (hours > 0 ? hours + 'æ™‚é–“' : '') + (minutes > 0 ? minutes + 'åˆ†' : '');
                dateDisplay = `${selectedFullDate} <span style="font-size:12px; color:#888; margin-left:5px;">(æ‰€è¦ ${timeText})</span>`;
            }

            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºã®ç”Ÿæˆ
            // selectedMenuï¼ˆå¤§åˆ†é¡ï¼‰ã‹ selectedSymptomï¼ˆè©³ç´°ï¼‰ã®ã©ã¡ã‚‰ã‹ã‚’è¡¨ç¤º
            let menuDisplay = '<span style="color:#ccc; font-weight:normal;">æœªé¸æŠ</span>';
            if (selectedSymptom && selectedSymptom.length > 0) {
                menuDisplay = selectedSymptom.join(' / ');
            } else if (selectedMenu) {
                menuDisplay = selectedMenu;
            }

            // HTMLç”Ÿæˆ
            const html = `
                <div class="c-date-area">
                    <span class="c-date-label">ã”äºˆç´„æ—¥æ™‚</span>
                    <div class="c-date-val">${dateDisplay}</div>
                    <span class="c-edit-link" onclick="scrollToElement('calendar1')">å¤‰æ›´</span>
                </div>

                <div class="c-user-grid">
                    <div class="c-user-item">
                        <span class="c-user-label">ãŠåå‰</span>
                        <div class="c-user-val">${name}</div>
                    </div>
                    
                    <div class="c-user-item">
                        <span class="c-user-label">æ¥åº—å›æ•°</span>
                        <div class="c-user-val">${visitCountText}</div>
                    </div>
                    <span class="c-edit-link" onclick="scrollToElement('name')" style="grid-column: 2; grid-row: 1;">ä¿®æ­£</span>
                </div>

                <div class="c-menu-area">
                    <span class="c-menu-label">ã”äºˆç´„ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
                    <div class="c-menu-val">${menuDisplay}</div>
                    <span class="c-edit-link c-menu-edit" onclick="scrollToElement('course')">ä¿®æ­£</span>
                </div>

                <div class="c-price-area">
                    <span class="c-price-label">ãŠæ”¯æ‰•ã„äºˆå®š</span>
                    <span class="c-price-val">${totalAmountText}</span>
                </div>
            `;

            document.getElementById('displayInfo').innerHTML = html;
        }

        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é–¢æ•°
        function scrollToElement(id) {
            const element = document.getElementById(id);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // å„ãƒœã‚¿ãƒ³ã‚„å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§updateDisplayInfoã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ã™ã‚‹
        document.getElementById('name').addEventListener('input', updateDisplayInfo);
        document.querySelectorAll('.visit-buttons button').forEach(button => {
            button.addEventListener('click', updateDisplayInfo);
        });
        document.querySelectorAll('.menu-sections button').forEach(button => {
            button.addEventListener('click', updateDisplayInfo);
        });
        document.querySelectorAll('.symptoms button').forEach(button => {
            button.addEventListener('click', updateDisplayInfo);
        });
        document.querySelectorAll('.irradiations button').forEach(button => {
            button.addEventListener('click', updateDisplayInfo);
        });

        document.querySelectorAll('.symptoms button').forEach(button => {
            button.addEventListener('click', () => {
                const calendarContainer = document.querySelector('.calendar-container');

                // é¸æŠã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚ã‚Œã°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’è¡¨ç¤º
                if (document.querySelectorAll('.symptoms button.active').length > 0) {
                    calendarContainer.style.display = 'block';
                } else {
                    // é¸æŠãŒè§£é™¤ã•ã‚ŒãŸå ´åˆã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’éè¡¨ç¤º
                    calendarContainer.style.display = 'none';
                }
            });
        });

        // åˆæœŸçŠ¶æ…‹ã§ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’éè¡¨ç¤ºã«ã™ã‚‹
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('.calendar-container').style.display = 'none';
        });

        // æ—¥ä»˜ã‚»ãƒ«ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã§å¸Œæœ›æ—¥æ™‚ã‚’æ›´æ–°
        document.querySelectorAll('.calendar td').forEach(cell => {
            cell.addEventListener('click', () => {
                selectDate(cell);
                updateDisplayInfo();  // æ—¥ä»˜ã‚’é¸æŠã—ãŸã‚‰å³åº§ã«è¡¨ç¤ºã‚’æ›´æ–°
            });
        });

        // å…±é€šã®HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆé–¢æ•°
        // title: ãƒ¡ãƒ‹ãƒ¥ãƒ¼åï¼ˆã‚³ãƒ¼ã‚¹åï¼‰
        // time: æ‰€è¦æ™‚é–“
        // price: æ–™é‡‘è¡¨ç¤ºæ–‡å­—åˆ—
        // hasInitialFee: åˆè¨ºæ–™ã®æœ‰ç„¡ï¼ˆtrue/falseï¼‰
        // detail: ã‚³ãƒ¼ã‚¹ã”ã¨ã®è©³ç´°èª¬æ˜ï¼ˆHTMLå¯ï¼‰
        // note: ä¸‹éƒ¨ã®æ³¨æ„æ›¸ãï¼ˆçœç•¥å¯ï¼‰
        const createContent = (
            title,
            time,
            price,
            hasInitialFee,
            detail = '',
            note = "â€»ç—‡çŠ¶ã«ã‚ˆã‚ŠãŠæ™‚é–“ãŒå‰å¾Œã™ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™"
        ) => {
            const initialFeeHtml = hasInitialFee
                ? '<div class="t-price-sub">åˆè¨ºæ–™ï¼šï¼‹0å††</div>'
                : '';

            const detailHtml = detail
                ? `<div class="t-detail">
                <i class="fas fa-list-ul t-icon"></i>
                ${detail}
           </div>`
                : '';

            return `
        <div class="treatment-content">
            <div class="t-title-row">
                <i class="fas fa-star t-icon"></i>
                <span class="t-title">${title}</span>
            </div>
            <div class="t-time-row">
                <i class="fas fa-clock t-icon"></i> æ‰€è¦æ™‚é–“ï¼š${time}
            </div>
            <div class="t-price-container">
                <div class="t-price-row">
                    <span class="t-price-label">æ–™é‡‘</span>
                    <span class="t-price-val">${price}</span>
                </div>
                ${initialFeeHtml}
            </div>
            ${detailHtml}
            <div class="t-note">
                <i class="fas fa-info-circle"></i> ${note}
            </div>
        </div>
    `;
        };


        function selectSymptom(button, treatmentId) {
            // é¸æŠã•ã‚ŒãŸæ—¥æ™‚ã‚’ãƒªã‚»ãƒƒãƒˆ
            selectedFullDate = '';

            const treatmentText = document.getElementById('treatment-text');
            const closeButtonHtml = '<button type="button" class="treatment-close" onclick="closeTreatmentText()">Ã—</button>';

            // ã‚¯ãƒªãƒƒã‚¯å‰ã«ãã®ãƒœã‚¿ãƒ³ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã ã£ãŸã‹
            const wasActive = button.classList.contains('active');

            // ä¸€æ—¦ãƒˆã‚°ãƒ«
            button.classList.toggle('active');

            // ä»Šã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ä¸€è¦§
            let updatedSelectedButtons = document.querySelectorAll('.symptoms button.active');

            // ã‚‚ã—ä»Šå›ã®ã‚¯ãƒªãƒƒã‚¯ã§ã€Œå…¨éƒ¨ã‚ªãƒ•ã€ã«ãªã£ãŸã‚‰ã€å„ç¨®ãƒªã‚»ãƒƒãƒˆã—ã¦çµ‚äº†
            if (updatedSelectedButtons.length === 0) {
                selectedMenuTime = 0;
                selectedSymptom = [];
                menuPrice = 0;
                treatmentText.style.display = 'none';
                treatmentText.innerHTML = '';
                return;
            }

            // å¸¸ã«1ã¤ã ã‘ active ã«ã™ã‚‹ï¼ˆè¤‡æ•°é¸æŠã•ã‚Œã¦ã„ãŸå ´åˆã®ä¿é™ºï¼‰
            if (updatedSelectedButtons.length > 1) {
                updatedSelectedButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                updatedSelectedButtons = document.querySelectorAll('.symptoms button.active');
            }

            // é¸æŠã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã«ä½¿ã†ï¼‰
            const selectedMenuLabel = button.textContent;

            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ™‚é–“ã‚„è¡¨ç¤ºç”¨é…åˆ—ãƒ»ä¾¡æ ¼ã‚’æ›´æ–°
            selectedMenuTime = menuTimes[selectedMenuLabel] || 0;
            selectedSymptom = [selectedMenuLabel];
            menuPrice = parseInt(button.getAttribute('data-price'), 10) || 0;

            console.log('é¸æŠã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ™‚é–“:', selectedMenuTime);

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚‚ä¿å­˜ï¼ˆtreatmentId ã‚’ä¿å­˜ã™ã‚‹ä»•æ§˜ã®ã¾ã¾ï¼‰
            let selectedSymptoms = [treatmentId];
            localStorage.setItem('selectedSymptoms', JSON.stringify(selectedSymptoms));

            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æ›´æ–°
            fetchAvailability(currentDate);

            // ğŸ”´ ã“ã“ã§ã€Œå‰å›ã¨åŒã˜ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€å®Ÿè¡Œä¸­ãªã‚‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¯å‡ºã•ãšçµ‚äº†
            if (isApplyingPreviousSelection) {
                treatmentText.style.display = 'none';
                treatmentText.innerHTML = '';
                return;
            }

            // â–¼ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä½œæˆ â–¼
            let content = '';

            if (treatmentId === 'treatment1') {
                content = createContent(
                    selectedMenuLabel,
                    'ç´„60åˆ†',
                    '0å††',
                    true,
                    'ã€ã“ã‚“ãªæ–¹ã«ãŠã™ã™ã‚ã€‘<br>' +
                    'ãƒãƒƒã‚µãƒ¼ã‚¸ã‚’ã—ã¦ã‚‚ã€ã‚¹ãƒˆãƒ¬ãƒƒãƒã‚’ã—ã¦ã‚‚è‰¯ããªã‚‰ãªã„<br>' +
                    'è‚©ã“ã‚Šãƒ»è…°ç—›ã«å›°ã£ã¦ã„ã‚‹ã€‚<br>' +
                    'ãã‚“ãªãŠæ‚©ã¿ã‚’æŠ±ãˆãŸæ–¹ã«ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚<br>' +
                    'ãªãœè‚©ãŒå‡ã‚‹ã®ã‹ï¼Ÿãªãœè…°ãŒç—›ã„ã®ã‹ï¼Ÿã‚’çŸ¥ã‚ŠãŸã„æ–¹<br>' +
                    'æ¯æ—¥ã€è¾›ã•ã‚’æ°—ã«ã™ã‚‹ã®ã¯ã‚‚ã†å«Œã ï¼<br>' +
                    'æ¸…ã€…ã—ã„æ°—æŒã¡ã§æ¯æ—¥ã‚’éã”ã—ãŸã„ï¼<br>' +
                    'ã¨ã„ã†æ–¹ã¯ã”ç›¸è«‡ãã ã•ã„ã€‚<br>' +
                    'é€šé™¢é »åº¦ã®ç›®å®‰ã¯1ãƒ¶æœˆ3ã€œ4å›'
                );
            } else if (treatmentId === 'treatment2') {
                content = createContent(
                    selectedMenuLabel,
                    'ç´„60åˆ†',
                    '0å††',
                    true,
                    'ã€ã“ã‚“ãªæ–¹ã«ãŠã™ã™ã‚ã€‘<br>' +
                    'è©¦åˆå‰ã®èº«ä½“ã®èª¿æ•´ã‚’ã—ã¦ä¸‡å…¨ã®çŠ¶æ…‹ã§è‡¨ã¿ãŸã„ï¼<br>' +
                    'ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®å‰ã«ä½“èª¿ã‚’æ•´ãˆãŸã„ï¼<br>' +
                    'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ã‚¢ãƒƒãƒ—ã—ãŸã„ï¼<br>' +
                    'å„ç«¶æŠ€ã®ç‰¹æ€§ã«åˆã‚ã›ãŸæ–½è¡“ã‚’ã„ãŸã—ã¾ã™ã€‚<br>' +
                    'ç”Ÿæ¶¯ã‚¹ãƒãƒ¼ãƒ„ã‚’æ¥½ã—ã¿ãŸã„æ–¹<br>' +
                    'ã‚¢ã‚¹ãƒªãƒ¼ãƒˆã®æ–¹<br>' +
                    'å­¦ç”Ÿã§ã‚¹ãƒãƒ¼ãƒ„ã‚’é ‘å¼µã£ã¦ã„ã‚‹æ–¹<br>' +
                    'å‹•ã‘ã‚‹ä½“ã‚’æ‰‹ã«å…¥ã‚Œã‚‹äº‹ãŒã§ãã¾ã™ï¼<br>' +
                    'é€šé™¢é »åº¦ã®ç›®å®‰ã¯1ãƒ¶æœˆ2ã€œ3å›'
                );
            } else if (treatmentId === 'treatment3') {
                content = createContent(
                    selectedMenuLabel,
                    'ç´„75åˆ†',
                    '0å††',
                    true,
                    'ã€ã“ã‚“ãªæ–¹ã«ãŠã™ã™ã‚ã€‘<br>' +
                    'ã‚‚ã¿ã»ãã—ã¦ã‚‚æ•´ä½“ã§ã‚‚è–¬ã‚’é£²ã‚“ã§ã‚‚è‰¯ããªã‚‰ãªã„é ­ç—›<br>' +
                    'ç—…é™¢ã§ã¯åŸå› ãŒã‚ã‹ã‚‰ãªã„ã‚ã¾ã„ã€å¯ã‚Œãªã„ã€ãŠè…¹ã®ä¸èª¿<br>' +
                    'ãªã©ã€ä¸å®‰ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã‚ˆã­ã€‚<br>' +
                    'ã¾ãšã¯ã€ãŠæ‚©ã¿ã‚’èã‹ã›ã¦ãã ã•ã„ã€‚<br>' +
                    'ãŠå­æ§˜ã§ã‚‚æ–½è¡“ã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<br>' +
                    'å­¦æ ¡ã«è¡Œã‘ãªã„ã€ç—…é™¢ã®å…ˆç”Ÿã®è¨€ã†ã¨ãŠã‚Šã«è–¬ã‚’é£²ã‚“ã§ã„ã‚‹ã‘ã‚Œã©<br>' +
                    'ç—‡çŠ¶ãŒå¤‰ã‚ã‚‰ãªã„ã¨è¨€ã†ãŠå­æ§˜ã®ç›¸è«‡ã‚‚å—ã‘ã¦ã„ã¾ã™ã€‚<br>' +
                    'é€šé™¢é »åº¦ã®ç›®å®‰ã¯1ãƒ¶æœˆ2ã€œ3å›'
                );
            } else if (treatmentId === 'treatment4') {
                content = createContent(
                    selectedMenuLabel,
                    'ç´„45åˆ†',
                    '0å††',
                    true,
                    'ä¸æ…®ã®äº‹æ…‹ã«ä½“ãŒã¤ã„ã¦ã„ã‹ãšã«ã‚±ã‚¬ã‚’ã™ã‚‹å ´åˆãŒå¤šã„ã§ã™ã€‚<br>' +
                    'ã‚‚ã¿ã»ãã—ãŸã‚Šã¯ã›ãšã€é–¢ç¯€ã‚„ç­‹è‚‰ã‚’ç·©ã‚è¡€è¡Œã‚’è‰¯ãã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šæå‚·éƒ¨ä½ã®æ—©æœŸå›å¾©ã‚’ä¿ƒã—ã¾ã™ã€‚<br>' +
                    'å ´åˆã«ã‚ˆã‚Šãƒ†ãƒ¼ãƒ”ãƒ³ã‚°ã€å›ºå®šå…·ã®ä½œæˆã€åŒ…å¸¯ãªã©ã«ã‚ˆã‚‹å›ºå®šã‚’ã—ã¾ã™ã€‚'
                );
            } else if (treatmentId === 'treatment5') {
                content = createContent(
                    selectedMenuLabel,
                    'ç´„30åˆ†',
                    '0å††',
                    false,
                    'ã€ã“ã‚“ãªæ–¹ã«ãŠã™ã™ã‚ã€‘<br>' +
                    'ä»Šã™ãã‚¹ãƒƒã‚­ãƒªã—ãŸã„ï¼<br>' +
                    'æ™‚é–“ãŒãªã„ã‘ã©ãƒãƒ§ãƒƒãƒˆã§ã‚‚ã„ã„ã‹ã‚‰æ¥½ã«ãªã‚ŠãŸã„ï¼<br>' +
                    'ã¨ã„ã†æ–¹ã«ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ï¼<br>' +
                    'ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚‚ã¿ã»ãã—ï¼‰ã¯ãƒªãƒ©ãƒƒã‚¯ã‚¹ã§ãã‚‹ã‘ã©ä½“ã¯ã‚ˆããªã‚‰ãªã„<br>' +
                    'æ•´ä½“ã‚’å—ã‘ãŸã„ã‘ã‚Œã©ã€ä¸€å›ã®æ–™é‡‘ãŒæ°—ã«ãªã£ã¦é€šã†ã“ã¨ã«èºŠèº‡ã—ã¦ã—ã¾ã†<br>' +
                    'ãã‚“ãªãŠæ‚©ã¿ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«<br>' +
                    'ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼‹æ²»ç™‚ã‚’å¯èƒ½ã«ã—ãŸã€æ–°ã—ã„æ–½è¡“æ–¹æ³•ã§ã™ï¼<br>' +
                    'ãƒãƒƒã‚µãƒ¼ã‚¸ã¨éª¨ç›¤çŸ¯æ­£ã‚’ã—ã¾ã™ã€‚<br>' +
                    'ãŸãã•ã‚“æ–½è¡“ã‚’å—ã‘ãŸã„ï¼ˆæœˆã«ï¼˜å›ä»¥ä¸Šï¼‰ã¨ã„ã†æ–¹ã«<br>' +
                    'ãŠå¾—ãªã‚µãƒ–ã‚¹ã‚¯ã‚‚ã”ç”¨æ„ã—ã¦ãŠã‚Šã¾ã™ï¼<br>' +
                    'é€šé™¢é »åº¦ã®ç›®å®‰ã¯1ãƒ¶æœˆã«6å›ã€œ'
                );
            } else if (treatmentId === 'treatment6') {
                content = createContent(
                    selectedMenuLabel,
                    'ç´„45åˆ†',
                    '0å††',
                    false,
                    'æ¥éª¨é™¢ã§ã¯ã€è‡ªè³ è²¬ä¿é™ºã€ä»»æ„ä¿é™ºã‚’ä½¿ç”¨ã—ãŸäº¤é€šäº‹æ•…ã®æ–½è¡“ãŒèªã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚<br>' +
                    'ç—‡çŠ¶ã‚„ç—›ã¿ã¯ã€äº‹æ•…ç›´å¾Œã«ç¾ã‚Œã¦ãã‚‹ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚<br>' +
                    'ãƒ¬ãƒ³ãƒˆã‚²ãƒ³æ¤œæŸ»ã§ã¯ã€Œç•°å¸¸ãªã—ã€ã§ã‚‚ã€ã¤ã‚‰ã„ç—‡çŠ¶ãŒé•·ãç¶šã„ã¦ã„ã‚‹æ–¹ã¯ã€å¾Œéºç—‡ãŒæ®‹ã‚‰ãªã„ã‚ˆã†ã«æ—©æœŸã®æ–½è¡“ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚'
                );
            } else if (treatmentId === 'treatment7') {
                content = createContent(
                    selectedMenuLabel,
                    '90åˆ†',
                    '8,700å††',
                    false,
                    'ãƒ»ã—ã£ã‹ã‚Šã‚±ã‚¢ã—ãŸã„æ–¹å‘ã‘ã®ãƒ­ãƒ³ã‚°ã‚³ãƒ¼ã‚¹ã§ã™ã€‚<br>' +
                    'ãƒ»ã‚·ã‚§ãƒ¼ãƒ“ãƒ³ã‚°ï¼‹ãƒãƒƒã‚µãƒ¼ã‚¸ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸã„æ–¹ã«ã€‚'
                );
            } else if (treatmentId === 'treatment8') {
                content = createContent(
                    selectedMenuLabel,
                    '15åˆ†',
                    '1,700å††',
                    false,
                    'ãƒ»çŸ­æ™‚é–“ã§å—ã‘ã‚‰ã‚Œã‚‹ãƒªãƒ©ãƒƒã‚¯ã‚¹ãƒãƒƒã‚µãƒ¼ã‚¸ã§ã™ã€‚<br>' +
                    'ãƒ»ä»–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ã®çµ„ã¿åˆã‚ã›ã«ã‚‚ãŠã™ã™ã‚ã§ã™ã€‚'
                );
            } else if (treatmentId === 'treatment9') {
                content = createContent(
                    selectedMenuLabel,
                    '15åˆ†',
                    '1,700å††',
                    false,
                    'ãƒ»åŸºæœ¬ã®ãƒãƒƒã‚µãƒ¼ã‚¸ã‚³ãƒ¼ã‚¹ã§ã™ã€‚<br>' +
                    'ãƒ»é¦–ãƒ»è‚©ã¾ã‚ã‚Šã®ã‚³ãƒªãŒæ°—ã«ãªã‚‹æ–¹ã«ã€‚'
                );
            } else {
                content = '';
            }

            // â˜…ã“ã“ãŒä»Šå›æŠœã‘ã¦ã„ãŸãƒã‚¤ãƒ³ãƒˆâ˜…
            if (content) {
                treatmentText.innerHTML = `${closeButtonHtml}${content}`;
            } else {
                treatmentText.innerHTML = '';
                treatmentText.style.display = 'none';
                return;
            }

            // å›ºå®šä½ç½®ã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            treatmentText.style.display = 'block';

            // â–¼ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã®ã™ãä¸‹ã«ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã•ã›ã‚‹ãŸã‚ã®ä½ç½®èª¿æ•´ â–¼
            const rect = button.getBoundingClientRect();
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

            // ä¸€æ—¦å·¦ä¸Šã«ç½®ã„ã¦å¹…ã‚’å–å¾—
            treatmentText.style.top = '0px';
            treatmentText.style.left = '0px';

            const cardWidth = treatmentText.offsetWidth || 280;
            let left = rect.left + scrollLeft;

            const maxLeft = scrollLeft + document.documentElement.clientWidth - cardWidth - 16;
            if (left > maxLeft) left = maxLeft;
            if (left < 8) left = 8;

            treatmentText.style.left = left + 'px';
            treatmentText.style.top = (rect.bottom + scrollTop + 8) + 'px';
            // â–² ã“ã“ã¾ã§ä½ç½®èª¿æ•´ â–²
        }

        function closeTreatmentText() {
            const treatmentText = document.getElementById('treatment-text');
            treatmentText.style.display = 'none';
        }

        function selectirradiations(button) {
            selectedFullDate = '';

            // ãƒˆã‚°ãƒ«
            button.classList.toggle('active');

            // âœ… ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã¿ã‚’å–å¾—ã—ä¿å­˜ï¼ˆéå»ãƒ‡ãƒ¼ã‚¿ç„¡è¦–ï¼‰
            const selectedButtons = document.querySelectorAll('.irradiations button.active');
            const selectedIrradiations = Array.from(selectedButtons).map(btn => btn.id);
            localStorage.setItem('selectedIrradiations', JSON.stringify(selectedIrradiations));

            // è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            const selectedIrradiationsNames = Array.from(selectedButtons).map(btn => btn.innerText);
            irradiationsCount = selectedIrradiationsNames.join(', ');

            // åˆè¨ˆé‡‘é¡ãªã©æ›´æ–°
            optionsPrice = 0;
            let totalirradiationsTime = 0;
            selectedButtons.forEach(btn => {
                const price = parseInt(btn.getAttribute('data-price'), 10);
                optionsPrice += price;

                const irradiationName = btn.innerText;
                const irradiationTime = irradiationsTimes[irradiationName] || 0;
                totalirradiationsTime += irradiationTime;
            });

            selectedirradiationsTime = totalirradiationsTime;

            fetchAvailability(currentDate);
            updateDisplayInfo();
        }

        function updateTotalAmount() {
            totalAmount = menuPrice + optionsPrice; // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ä¾¡æ ¼ã‚‚å«ã‚ã‚‹
            updateDisplayInfo(); // è¡¨ç¤ºã‚’æ›´æ–°
        }

        function selectVisit(element) {
            // é¸æŠã•ã‚ŒãŸæ—¥æ™‚ã‚’ãƒªã‚»ãƒƒãƒˆ
            selectedFullDate = '';

            document.getElementById('firstVisit').classList.remove('active');
            document.getElementById('repeatVisit').classList.remove('active');
            element.classList.add('active');
            visitCount = element.innerText;

            // é¸æŠã•ã‚ŒãŸè¨ªå•å›æ•°ã«å¯¾å¿œã™ã‚‹æ™‚é–“ã‚’å–å¾—
            selectedVisitTime = visitTimes[visitCount];

            console.log('é¸æŠã•ã‚ŒãŸè¨ªå•å›æ•°ã®æ™‚é–“:', selectedVisitTime);

            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã«å–å¾—ã™ã‚‹æ—¥ä»˜ã‚’æ¸¡ã™
            fetchAvailability(currentDate);
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é¸æŠã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
        function selectMenu(element) {
            element.classList.toggle('selected');

            let selectedMenus = JSON.parse(localStorage.getItem('selectedMenus') || '[]');
            const menuId = element.id;

            if (element.classList.contains('selected')) {
                selectedMenus.push(menuId);
            } else {
                selectedMenus = selectedMenus.filter(id => id !== menuId);
            }

            localStorage.setItem('selectedMenus', JSON.stringify(selectedMenus));
        }

        function showMenu(menu) {
            // treatment-text ã‚’éè¡¨ç¤ºã«ã™ã‚‹
            document.getElementById("treatment-text").style.display = "none";

            // é¸æŠã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®åå‰ã‚’å–å¾—
            let selectedButton = document.querySelector(`.menu-sections button[onclick="showMenu('${menu}')"]`);

            if (selectedButton) {
                selectedMenu = selectedButton.innerText;
            }

            // âœ… ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼è­˜åˆ¥å­ã‚’ä¿å­˜ï¼ˆè¿½åŠ ï¼‰
            localStorage.setItem('selectedMenu', menu); // â†ã“ã®è¡Œã‚’è¿½åŠ ï¼

            // ã™ã¹ã¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã®é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.menu-sections button').forEach(button => {
                button.classList.remove('active');
            });

            // é¸æŠã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤ºï¼‹ãƒœã‚¿ãƒ³çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.menu-section').forEach(section => {
                section.classList.remove('active');
                section.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            });

            // å¯¾å¿œã™ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹
            if (selectedButton) {
                selectedButton.classList.add('active');
                selectMenu(selectedButton);
            }

            // é¸æŠã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            document.getElementById(menu).classList.add('active');

            // treatment-text ã®å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById("treatment-text").innerHTML = "";

            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
            selectedSymptom = '';      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒªã‚»ãƒƒãƒˆ
            irradiationsCount = '';    // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒªã‚»ãƒƒãƒˆ
            menuPrice = 0;             // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ä¾¡æ ¼ãƒªã‚»ãƒƒãƒˆ
            optionsPrice = 0;          // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ä¾¡æ ¼ãƒªã‚»ãƒƒãƒˆ
            totalAmount = 0;           // åˆè¨ˆé‡‘é¡ãƒªã‚»ãƒƒãƒˆ

            // è¡¨ç¤ºã‚’æ›´æ–°
            updateDisplayInfo();
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰é¸æŠçŠ¶æ…‹ã‚’å¾©å…ƒ
        document.addEventListener("DOMContentLoaded", () => {
            let selectedMenus = JSON.parse(localStorage.getItem('selectedMenus') || '[]');
            selectedMenus.forEach(menuId => {
                let menuButton = document.getElementById(menuId);
                if (menuButton) {
                    menuButton.classList.add('selected');
                }
            });
        });

        function selectDate(cell) {
            // "unavailable" ã‚¯ãƒ©ã‚¹ãŒä»˜ã„ã¦ã„ã‚‹å ´åˆã¯ã‚¯ãƒªãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–
            if (cell.classList.contains('unavailable')) {
                return; // ä½•ã‚‚ã›ãšã«çµ‚äº†
            }

            // æ—¢ã«é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚»ãƒ«ã®é¸æŠã‚’è§£é™¤
            const cells = document.querySelectorAll('.calendar td');
            cells.forEach(td => td.classList.remove('selected'));

            // æ–°ã—ã„ã‚»ãƒ«ã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹
            cell.classList.add('selected');

            // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã¨æ™‚é–“ã‚’å–å¾—
            const selectedDay = cell.getAttribute('data-date'); // ISOå½¢å¼ã®æ—¥ä»˜
            const selectedTime = cell.parentElement.firstChild.textContent; // æ™‚é–“
            const date = new Date(selectedDay);

            // æ—¥ä»˜éƒ¨åˆ†ã‚’ã€Œâ—‹â—‹å¹´â—‹â—‹æœˆâ—‹â—‹æ—¥ â—‹â—‹:â—‹â—‹ã€å½¢å¼ã«å¤‰æ›
            selectedFullDate = `${date.getFullYear()}å¹´${('0' + (date.getMonth() + 1)).slice(-2)}æœˆ${('0' + date.getDate()).slice(-2)}æ—¥ ${selectedTime}`;

            // å¸Œæœ›æ—¥æ™‚ã‚’å³åº§ã«æ›´æ–°
            updateDisplayInfo();
        }

        function submitForm() {
            const formData = {
                name: document.getElementById('name').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                visitCount: visitCount,
                selectedMenu: selectedMenu,
                selectedSymptom: selectedSymptom && selectedSymptom.length > 0 ? selectedSymptom : null,
                irradiationsCount: irradiationsCount,
                dates: selectedFullDate ? [selectedFullDate] : null,
                message: document.getElementById('message').value.trim()
            };

            // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚§ãƒƒã‚¯
            if (!formData.name) {
                alert('ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            if (!formData.phone) {
                alert('é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            if (!formData.selectedSymptom) {
                alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            if (!formData.dates) {
                alert('å¸Œæœ›æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // â˜… irradiationsCount ãŒã‚ã‚‹ã¨ãã ã‘ ",â—‹â—‹" ã‚’ä»˜ã‘ã‚‹
            const irradiationsPart = formData.irradiationsCount
                ? `,${formData.irradiationsCount}`
                : '';

            // LINEãƒˆãƒ¼ã‚¯ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
            liff.sendMessages([{
                type: 'text',
                text:
                    `ã€äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ã€‘\n` +
                    `ãŠåå‰ï¼š${formData.name}\n` +
                    `é›»è©±ç•ªå·ï¼š${formData.phone}\n` +
                    `ã”æ¥åº—å›æ•°ï¼š${formData.visitCount}\n` +
                    // ã“ã“ã§æ¡ä»¶ä»˜ãã®æ–‡å­—åˆ—ã‚’ä½¿ç”¨
                    `ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼š${formData.selectedSymptom}${irradiationsPart}\n` +
                    `å¸Œæœ›æ—¥æ™‚ï¼š\n ${formData.dates[0]}\n` +
                    `ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š${formData.message}`
            }]).then(() => {
                alert('å½“æ—¥ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯ç„¡ã„ã‚ˆã†ã«ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚');
                liff.closeWindow();
            }).catch((err) => {
                console.error('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ', err);
            });
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return `${date.getFullYear()}å¹´${('0' + (date.getMonth() + 1)).slice(-2)}æœˆ${('0' + date.getDate()).slice(-2)}æ—¥ ${('0' + date.getHours()).slice(-2)}:${('0' + date.getMinutes()).slice(-2)}`;
        }

        async function fetchAvailability(date) {
            const startTime = new Date(date);
            const endTime = new Date(date);
            endTime.setDate(endTime.getDate() + 7);

            const cacheKey = startTime.toISOString() + endTime.toISOString();

            // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¢ºèª
            if (availabilityCache[cacheKey]) {
                console.log('Using cached data');
                updateCalendar(availabilityCache[cacheKey].availability, availabilityCache[cacheKey].businessDays);
                return;
            }

            const url = 'https://script.google.com/macros/s/AKfycbwCxnJaxGZ46c3TnnesuZcD_zuxuVoSHoDHo5MxkRzChcK5vZDwBs4HstzkXO-KLyuDYA/exec' +
                `?startTime=${startTime.toISOString()}&endTime=${endTime.toISOString()}`;

            try {
                showLoadingSpinner(); // Show loading spinner
                const response = await fetch(url);
                const data = await response.json();
                console.log(data);

                // å–¶æ¥­æ—¥ã®æƒ…å ±ã‚’æŠ½å‡º
                const businessDays = data.filter(event => event.summary === "å–¶æ¥­æ—¥").map(event => {
                    return {
                        start: new Date(event.startTime),
                        end: new Date(event.endTime)
                    };
                });

                // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
                availabilityCache[cacheKey] = { availability: data, businessDays: businessDays };

                updateCalendar(data, businessDays);
            } catch (error) {
                console.error('Error fetching availability:', error);
            } finally {
                hideLoadingSpinner(); // Hide loading spinner
            }
        }

function updateCalendar(availability, businessDays) {
            const calendar = document.getElementById('calendar1');
            const table = calendar.querySelector('table tbody');

            const times = [
                '09:00', '09:15', '09:30', '09:45',
                '10:00', '10:15', '10:30', '10:45',
                '11:00', '11:15', '11:30', '11:45',
                '12:00', '12:15', '12:30', '12:45',
                '13:00', '13:15', '13:30', '13:45',
                '14:00', '14:15', '14:30', '14:45',
                '15:00', '15:15', '15:30', '15:45',
                '16:00', '16:15', '16:30', '16:45',
                '17:00', '17:15', '17:30', '17:45',
                '18:00', '18:15', '18:30', '18:45',
                '19:00', '19:15', '19:30'
            ];

            // ãƒ†ãƒ¼ãƒ–ãƒ«åˆæœŸåŒ–ï¼ˆè¡ŒãŒãªã‘ã‚Œã°ä½œæˆï¼‰
            if (table.rows.length === 0) {
                for (const time of times) {
                    const row = document.createElement('tr');
                    const timeCell = document.createElement('td');
                    timeCell.textContent = time;
                    row.appendChild(timeCell);

                    for (let i = 0; i < 7; i++) {
                        const cell = document.createElement('td');
                        cell.addEventListener('click', () => selectDate(cell));
                        row.appendChild(cell);
                    }
                    table.appendChild(row);
                }
            }

            // ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–°
            updateCalendarHeader(currentDate);

            // ã‚»ãƒ«ã®ãƒªã‚»ãƒƒãƒˆ
            for (let row of table.rows) {
                for (let i = 1; i < row.cells.length; i++) {
                    row.cells[i].textContent = '';
                    row.cells[i].removeAttribute('data-date');
                    row.cells[i].className = ''; 
                }
            }

            const now = new Date();

            // --- æ—¥ä»˜ã”ã¨ã®ãƒ«ãƒ¼ãƒ— ---
            for (let i = 0; i < 7; i++) {
                const day = new Date(currentDate);
                day.setDate(day.getDate() + i);

                // ãã®æ—¥ã®ã€Œå–¶æ¥­æ—¥ã€ã‚¤ãƒ™ãƒ³ãƒˆã®æ™‚é–“å¸¯ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—
                let businessEventTimes = [];
                availability.forEach(slot => {
                    const eventStart = new Date(slot.startTime);
                    const eventEnd = new Date(slot.endTime);
                    if (slot.title && slot.title.includes("å–¶æ¥­æ—¥") && eventStart.toDateString() === day.toDateString()) {
                        businessEventTimes.push({ start: eventStart, end: eventEnd });
                    }
                });

                // --- æ™‚é–“ã”ã¨ã®ãƒ«ãƒ¼ãƒ— ---
                for (let j = 0; j < times.length; j++) {
                    const cell = table.rows[j].cells[i + 1];

                    // ã“ã®ã‚»ãƒ«ã®é–‹å§‹æ™‚é–“
                    const slotStart = new Date(day);
                    slotStart.setHours(parseInt(times[j].split(':')[0]), parseInt(times[j].split(':')[1]), 0, 0);

                    // ã“ã®ã‚»ãƒ«ã®çµ‚äº†æ™‚é–“ï¼ˆæ–½è¡“æ™‚é–“ã‚’åŠ ç®—ï¼‰
                    const slotEnd = new Date(slotStart);
                    let totalDuration = (selectedMenuTime || 10) + (selectedVisitTime || 0) + (selectedirradiationsTime || 0);
                    slotEnd.setMinutes(slotStart.getMinutes() + totalDuration);

                    // ã‚»ãƒ«ã«æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
                    cell.setAttribute('data-date', slotStart.toISOString());

                    // æ›œæ—¥ã€æ™‚ã€åˆ†ã‚’å–å¾—ï¼ˆåˆ¤å®šç”¨ï¼‰
                    const dayOfWeek = slotStart.getDay(); // 0:æ—¥, 1:æœˆ... 3:æ°´... 6:åœŸ
                    const hour = slotStart.getHours();
                    const min = slotStart.getMinutes();


                    // ============================================
                    // åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå„ªå…ˆé †ä½é †ï¼‰
                    // ============================================

                    // ã€æ¡ä»¶1ã€‘éå»ã®æ—¥æ™‚ã€ã¾ãŸã¯æ—¥ä»˜ã‚’ã¾ãŸãäºˆç´„ â¡ âœ•
                    if (slotStart < now || slotEnd.getDate() !== slotStart.getDate()) {
                        setUnavailable(cell);
                        continue; 
                    }

                    // ã€æ¡ä»¶2ã€‘ï¼ˆæœ€å„ªå…ˆï¼‰æ—¢ã«ä»–ã®äºˆç´„ãŒå…¥ã£ã¦ã„ã‚‹ã‹ï¼Ÿ â¡ âœ•
                    const isBooked = availability.some(slot => {
                        if (slot.title && slot.title.includes("å–¶æ¥­æ—¥")) return false;
                        const eventStart = new Date(slot.startTime);
                        const eventEnd = new Date(slot.endTime);
                        return slotStart < eventEnd && slotEnd > eventStart;
                    });

                    if (isBooked) {
                        setUnavailable(cell);
                        continue; 
                    }

                    // ã€æ¡ä»¶3ã€‘ï¼ˆå„ªå…ˆåº¦é«˜ï¼‰ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã€Œå–¶æ¥­æ—¥ã€ã¨å…¥ã£ã¦ã„ã‚‹ã‹ï¼Ÿ â¡ ã€‡
                    // äºˆç´„ãŒãªãã€Œå–¶æ¥­æ—¥ã€æ å†…ãªã‚‰ã€ä»¥ä¸‹ã®å®šä¼‘æ—¥ãƒ«ãƒ¼ãƒ«ã‚’ç„¡è¦–ã—ã¦ã€‡ã«ã™ã‚‹
                    const isInsideBusinessEvent = businessEventTimes.some(event => {
                        return slotStart >= event.start && slotStart < event.end;
                    });

                    if (isInsideBusinessEvent) {
                        setAvailable(cell);
                        continue; 
                    }


                    // ã€æ¡ä»¶4ã€‘ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®åˆ¶é™ãƒ«ãƒ¼ãƒ«ï¼ˆå–¶æ¥­æ—¥æŒ‡å®šãŒãªã„å ´åˆã«é©ç”¨ï¼‰

                    // 4-A. æ—¥æ›œæ—¥(0) ã¨ æ°´æ›œæ—¥(3) ã¯ä¼‘ã¿ â¡ âœ•
                    if (dayOfWeek === 0 || dayOfWeek === 3) {
                        setUnavailable(cell);
                        continue;
                    }

                    // 4-B. ãŠæ˜¼ä¼‘ã¿ (12:45 ã€œ 14:59 é–‹å§‹ã®æ ) ã¯äºˆç´„ä¸å¯ â¡ âœ•
                    // 12æ™‚å°ã¯45åˆ†ä»¥é™NGã€13æ™‚å°å…¨NGã€14æ™‚å°å…¨NG
                    if (
                        (hour === 12 && min >= 45) ||
                        (hour === 13) ||
                        (hour === 14)
                    ) {
                        setUnavailable(cell);
                        continue;
                    }

                    // 4-C. åœŸæ›œæ—¥(6) ã¯ 18:01 ã€œ 20:00 ã®æ™‚é–“å¸¯ã¯äºˆç´„ä¸å¯ â¡ âœ•
                    // 18:00ã‚¸ãƒ£ã‚¹ãƒˆé–‹å§‹ã¯OKã€18:01ä»¥é™(18:15ã€œ)ã¯NG
                    if (dayOfWeek === 6) {
                        if (
                            (hour === 18 && min >= 1) ||
                            (hour >= 19)
                        ) {
                            setUnavailable(cell);
                            continue;
                        }
                    }

                    // ã€æ¡ä»¶5ã€‘ã™ã¹ã¦ã®NGæ¡ä»¶ã‚’ã‚¯ãƒªã‚¢ â¡ ã€‡
                    setAvailable(cell);
                }
            }
        }

        function setAvailable(cell) {
            cell.textContent = 'â—¯';
            cell.classList.add('available');
            cell.classList.remove('unavailable');
        }

        function setUnavailable(cell) {
            cell.textContent = 'âœ•';
            cell.classList.add('unavailable');
            cell.classList.remove('available');
        }

        function updateCalendarHeader(date) {
            const headerRow = document.getElementById('calendar-header');
            const headers = headerRow.querySelectorAll('th:not(:first-child)');

            // ã‚µãƒ³ãƒ—ãƒ«ã®ç¥æ—¥ãƒ‡ãƒ¼ã‚¿ï¼ˆå¿…è¦ã«å¿œã˜ã¦å‹•çš„ã«å–å¾—ã‚‚æ¤œè¨ï¼‰
            const holidays = [
                '2025-02-11', // å»ºå›½è¨˜å¿µã®æ—¥
                '2025-02-23', // å¤©çš‡èª•ç”Ÿæ—¥
                '2025-02-24', // å¤©çš‡èª•ç”Ÿæ—¥ æŒ¯æ›¿ä¼‘æ—¥
                '2025-03-20', // æ˜¥åˆ†ã®æ—¥
                '2025-04-29', // æ˜­å’Œã®æ—¥
                '2025-05-03', // æ†²æ³•è¨˜å¿µæ—¥
                '2025-05-04', // ã¿ã©ã‚Šã®æ—¥
                '2025-05-05', // ã“ã©ã‚‚ã®æ—¥
                '2025-05-06', // ã¿ã©ã‚Šã®æ—¥ æŒ¯æ›¿ä¼‘æ—¥
                '2025-07-21', // æµ·ã®æ—¥
                '2025-08-11', // å±±ã®æ—¥
                '2025-09-15', // æ•¬è€ã®æ—¥
                '2025-09-23', // ç§‹åˆ†ã®æ—¥
                '2025-10-13', // ä½“è‚²ã®æ—¥
                '2025-11-03', // æ–‡åŒ–ã®æ—¥
                '2025-11-23', // å‹¤åŠ´æ„Ÿè¬ã®æ—¥
                '2025-11-24', // å‹¤åŠ´æ„Ÿè¬ã®æ—¥ æŒ¯æ›¿ä¼‘æ—¥
                '2026-01-01', // å…ƒæ—¥
                '2026-01-12', // æˆäººã®æ—¥
                '2026-02-11', // å»ºå›½è¨˜å¿µã®æ—¥
                '2026-02-23', // å¤©çš‡èª•ç”Ÿæ—¥
                '2026-03-20', // æ˜¥åˆ†ã®æ—¥
                '2026-04-29', // æ˜­å’Œã®æ—¥
                '2026-05-03', // æ†²æ³•è¨˜å¿µæ—¥
                '2026-05-04', // æ†²æ³•è¨˜å¿µæ—¥ æŒ¯æ›¿ä¼‘æ—¥
                '2026-05-05', // ã¿ã©ã‚Šã®æ—¥
                '2026-05-06', // ã“ã©ã‚‚ã®æ—¥
                '2026-07-20', // æµ·ã®æ—¥
                '2026-08-11', // å±±ã®æ—¥
                '2026-09-21', // æ•¬è€ã®æ—¥
                '2026-09-22', // å›½æ°‘ã®ä¼‘æ—¥
                '2026-09-23', // ç§‹åˆ†ã®æ—¥
                '2026-10-12', // ä½“è‚²ã®æ—¥
                '2026-11-03', // æ–‡åŒ–ã®æ—¥
                '2026-11-23', // å‹¤åŠ´æ„Ÿè¬ã®æ—¥
                '2027-01-01', // å…ƒæ—¥
                '2027-01-11', // æˆäººã®æ—¥
                '2027-02-11', // å»ºå›½è¨˜å¿µã®æ—¥
                '2027-02-23', // å¤©çš‡èª•ç”Ÿæ—¥
                '2027-03-20', // æ˜¥åˆ†ã®æ—¥
                '2027-04-29', // æ˜­å’Œã®æ—¥
                '2027-05-03', // æ†²æ³•è¨˜å¿µæ—¥
                '2027-05-04', // ã¿ã©ã‚Šã®æ—¥
                '2027-05-05', // ã“ã©ã‚‚ã®æ—¥
                '2027-07-19', // æµ·ã®æ—¥
                '2027-08-11', // å±±ã®æ—¥
                '2027-09-20', // æ•¬è€ã®æ—¥
                '2027-09-23', // ç§‹åˆ†ã®æ—¥
                '2027-10-11', // ä½“è‚²ã®æ—¥
                '2027-11-03', // æ–‡åŒ–ã®æ—¥
                '2027-11-23', // å‹¤åŠ´æ„Ÿè¬ã®æ—¥
                '2028-01-01', // å…ƒæ—¥
                '2028-01-10', // æˆäººã®æ—¥
                '2028-02-11', // å»ºå›½è¨˜å¿µã®æ—¥
                '2028-02-23', // å¤©çš‡èª•ç”Ÿæ—¥
                '2028-03-20', // æ˜¥åˆ†ã®æ—¥
                '2028-04-29', // æ˜­å’Œã®æ—¥
                '2028-05-03', // æ†²æ³•è¨˜å¿µæ—¥
                '2028-05-04', // ã¿ã©ã‚Šã®æ—¥
                '2028-05-05', // ã“ã©ã‚‚ã®æ—¥
                '2028-07-17', // æµ·ã®æ—¥
                '2028-08-11', // å±±ã®æ—¥
                '2028-09-18', // æ•¬è€ã®æ—¥
                '2028-09-22', // ç§‹åˆ†ã®æ—¥
                '2028-10-09', // ä½“è‚²ã®æ—¥
                '2028-11-03', // æ–‡åŒ–ã®æ—¥
                '2028-11-23'  // å‹¤åŠ´æ„Ÿè¬ã®æ—¥
            ];

            const startDate = new Date(date);
            headers.forEach((th, index) => {
                const day = new Date(startDate);
                day.setDate(day.getDate() + index);

                const dayOfWeek = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
                const formattedDate = `${day.getFullYear()}-${(day.getMonth() + 1).toString().padStart(2, '0')}-${day.getDate().toString().padStart(2, '0')}`;
                const dayString = `${day.getDate()}(${dayOfWeek[day.getDay()]})`;

                th.innerHTML = dayString.replace('(', '<br>(');

                // ç¥æ—¥ã‚’èµ¤è‰²ã«å¤‰æ›´ï¼ˆæ›œæ—¥åˆ¤å®šã§ã¯ãªãå®Œå…¨ä¸€è‡´åˆ¤å®šï¼‰
                if (holidays.includes(formattedDate)) {
                    th.style.color = 'red';
                } else if (day.getDay() === 0) { // æ—¥æ›œæ—¥ï¼ˆèµ¤ï¼‰
                    th.style.color = 'red';
                } else if (day.getDay() === 6) { // åœŸæ›œæ—¥ï¼ˆé’ï¼‰
                    th.style.color = 'blue';
                } else {
                    th.style.color = ''; // é€šå¸¸è‰²ã«ãƒªã‚»ãƒƒãƒˆ
                }
            });

            // ç¾åœ¨ã®æœˆã‚’è¡¨ç¤º
            const currentMonthElement = document.getElementById('currentMonth');
            currentMonthElement.innerHTML = `<span class="year">${startDate.getFullYear()}å¹´</span><span class="month">${startDate.getMonth() + 1}æœˆ</span>`;

        }

        function nextmonth() {
            currentDate.setMonth(currentDate.getMonth() + 1); // ç¿Œæœˆã«ç§»å‹•
            currentDate.setDate(1); // 1æ—¥ã«è¨­å®š
            fetchAvailability(currentDate);
        }

        function previousmonth() {
            currentDate.setMonth(currentDate.getMonth() - 1); // å‰æœˆã«ç§»å‹•
            currentDate.setDate(1); // 1æ—¥ã«è¨­å®š
            fetchAvailability(currentDate);
        }

        function nextWeek() {
            currentDate.setDate(currentDate.getDate() + 7);
            fetchAvailability(currentDate);
        }

        function previousWeek() {
            currentDate.setDate(currentDate.getDate() - 7);
            fetchAvailability(currentDate);
        }

        function showLoadingSpinner() {
            document.getElementById('loadingSpinner').style.display = 'block';
        }

        function hideLoadingSpinner() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }
    </script>
</body>

</html>
