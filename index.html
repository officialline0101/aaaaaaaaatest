<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>サクラ急送 予約フォーム</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <style>
        /* --------------------------------------------------
           サクラ急送 デザインテーマ定義
           -------------------------------------------------- */
        :root {
            --sakura-primary: #ff8da1;       /* メインの桜色 */
            --sakura-dark: #ff6b85;          /* 濃い桜色（ホバー時など） */
            --sakura-light: #fff0f4;         /* 薄い背景用ピンク */
            --sakura-gradient: linear-gradient(135deg, #ff9eb5 0%, #ff758c 100%); /* ボタン用グラデーション */
            --text-main: #4a4a4a;            /* 基本文字色 */
            --text-light: #888888;           /* 補足文字色 */
            --bg-color: #fff9fa;             /* 全体背景 */
            --card-shadow: 0 10px 30px rgba(255, 141, 161, 0.15); /* ふんわりした影 */
            --radius-box: 12px;              /* 入力欄の角丸 */
            --radius-card: 24px;             /* カードの角丸 */
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#ffebf0 1px, transparent 1px);
            background-size: 20px 20px; /* ドット柄で可愛らしさを演出 */
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px 10px;
            box-sizing: border-box;
        }

        /* --------------------------------------------------
           メインコンテナ（カードデザイン）
           -------------------------------------------------- */
        .container {
            background-color: #ffffff;
            border-radius: var(--radius-card);
            box-shadow: var(--card-shadow);
            width: 100%;
            max-width: 600px; /* 少し広げて見やすく */
            padding: 40px 30px;
            box-sizing: border-box;
            position: relative;
            margin-bottom: 50px;
            border: 1px solid #fff0f4;
        }

        /* --------------------------------------------------
           ロゴ画像
           -------------------------------------------------- */
        .logo-image {
            display: block;
            max-width: 200px; /* 最大幅を制限 */
            width: 100%;
            height: auto;
            margin: 0 auto 20px auto; /* 中央揃えと下の余白 */
            transform: translateX(-5px); /* 左に微調整 */
        }

        /* --------------------------------------------------
           ヘッダー・タイトル
           -------------------------------------------------- */
        h1 {
            font-family: 'Zen Maru Gothic', sans-serif;
            color: var(--sakura-primary);
            text-align: center;
            font-size: 28px;
            margin-bottom: 40px;
            position: relative;
            background: none;
            box-shadow: none;
            padding: 0;
            border: none;
        }

        h1 .small-text {
            font-size: 16px;
            color: var(--text-light);
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        /* タイトルの装飾（下線） */
        h1::after {
            content: '';
            display: block;
            width: 60px;
            height: 4px;
            background: var(--sakura-primary);
            margin: 15px auto 0;
            border-radius: 2px;
        }

        /* --------------------------------------------------
           ラベル（見出し）スタイル
           -------------------------------------------------- */
        .label, .labelkibounitizi, .labeltyuuou, .labelmessezi {
            font-family: 'Zen Maru Gothic', sans-serif;
            display: flex;
            align-items: center;
            background: transparent;
            color: var(--text-main);
            font-size: 18px;
            font-weight: 700;
            margin: 30px 0 15px 0;
            padding: 0 0 0 12px;
            border: none;
            border-left: 5px solid var(--sakura-primary); /* 左側にアクセントバー */
            text-align: left;
            text-indent: 0;
            line-height: 1.4;
        }

        .labeltyuuou {
            justify-content: center;
            border-left: none;
            text-align: center;
            font-size: 22px;
            margin-top: 50px;
            color: var(--sakura-primary);
        }

        /* 必須バッジ */
        .required {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #ff5e78;
            color: #fff;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 20px;
            margin-left: 10px;
            font-weight: bold;
            vertical-align: middle;
            display: inline-block;
        }

        /* 補足テキスト */
        .sub-text {
            font-size: 13px;
            color: var(--text-light);
            font-weight: normal;
            margin-left: 8px;
        }

        /* --------------------------------------------------
           入力フォーム（Input / Select / Textarea）
           -------------------------------------------------- */
        input[type="text"],
        input[type="tel"],
        input[type="number"],
        textarea,
        .datetime-input {
            width: 100%;
            padding: 15px;
            background-color: #fafafa;
            border: 2px solid #f0f0f0;
            border-radius: var(--radius-box);
            font-size: 16px;
            color: var(--text-main);
            box-sizing: border-box;
            transition: all 0.3s ease;
            appearance: none; /* iOSのリセット */
            margin-bottom: 10px;
        }

        input:focus,
        textarea:focus,
        .datetime-input:focus {
            background-color: #fff;
            border-color: var(--sakura-primary);
            box-shadow: 0 0 0 4px rgba(255, 141, 161, 0.1);
            outline: none;
        }

        /* --------------------------------------------------
           荷物リスト（チェックボックスグリッド）
           -------------------------------------------------- */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2列 */
            gap: 12px;
            margin-bottom: 20px;
        }

        .item-label {
            display: flex;
            align-items: center;
            justify-content: flex-start; /* 左寄せ */
            padding: 12px 15px;
            background-color: #fff;
            border: 2px solid #f0f0f0;
            border-radius: var(--radius-box);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: var(--text-main);
            position: relative;
            overflow: hidden;
        }

        .item-label:hover {
            border-color: var(--sakura-primary);
            background-color: var(--sakura-light);
        }

        /* チェックボックス本体（見た目は隠すが機能は残す） */
        .item-label input[type="checkbox"] {
            accent-color: var(--sakura-primary);
            margin-right: 10px;
            transform: scale(1.2);
        }

        /* 選択時のスタイル */
        .item-label:has(input:checked),
        .item-label.checked {
            background-color: var(--sakura-light);
            border-color: var(--sakura-primary);
            color: var(--sakura-dark);
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(255, 141, 161, 0.15);
        }
        
        /* チェックマーク装飾 */
        .item-label:has(input:checked)::after,
        .item-label.checked::after {
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            content: "\f00c"; /* check icon */
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--sakura-primary);
            font-size: 14px;
        }

        /* --------------------------------------------------
           エレベーターボタン
           -------------------------------------------------- */
        .elevator-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .elevator-buttons button {
            flex: 1;
            padding: 14px;
            background-color: #fff;
            border: 2px solid #f0f0f0;
            border-radius: 30px; /* 丸ボタン */
            color: var(--text-main);
            font-weight: bold;
            transition: all 0.3s;
        }

        .elevator-buttons button:hover {
            border-color: var(--sakura-primary);
        }

        .elevator-buttons button.active {
            background: var(--sakura-primary);
            border-color: var(--sakura-primary);
            color: #fff;
            box-shadow: 0 4px 10px rgba(255, 141, 161, 0.4);
        }

        /* --------------------------------------------------
           日付選択エリア
           -------------------------------------------------- */
        .datetime-wrapper {
            background: var(--sakura-light);
            padding: 20px;
            border-radius: var(--radius-box);
            margin-bottom: 15px;
        }

        .placeholder {
            display: block;
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--sakura-dark);
            font-weight: bold;
        }

        .dt-grid {
            display: flex;
            gap: 10px;
        }

        .dt-grid select {
            background-color: #fff;
            cursor: pointer;
            border: 1px solid #e0e0e0;
        }

        /* --------------------------------------------------
           確認画面エリア
           -------------------------------------------------- */
        #displayInfo {
            background-color: #fff;
            border: 1px solid #f0f0f0;
            border-radius: var(--radius-box);
            padding: 20px;
            margin-bottom: 30px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start; /* 上揃えに変更 */
            padding: 12px 0;
            border-bottom: 1px dashed #eee;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-row p {
            margin: 0;
            font-size: 15px;
            line-height: 1.6;
        }

        .info-row strong {
            color: var(--sakura-dark);
            display: block;
            font-size: 12px;
            margin-bottom: 2px;
        }

        /* 修正ボタン */
        .edit-button {
            background: #fff;
            border: 1px solid #ddd;
            color: #888;
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 20px;
            height: auto;
            margin-left: 10px;
        }

        .edit-button:hover {
            border-color: var(--sakura-primary);
            color: var(--sakura-primary);
            background: #fff;
        }

        /* --------------------------------------------------
           送信ボタン
           -------------------------------------------------- */
        .submit-button {
            width: 100%;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            background: var(--sakura-gradient);
            border: none;
            border-radius: 50px; /* カプセル型 */
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 117, 140, 0.4);
            transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
            margin-top: 20px;
            letter-spacing: 0.05em;
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 117, 140, 0.6);
        }

        .submit-button:active {
            transform: translateY(1px);
        }

        /* 連打防止用の無効化スタイル */
        .submit-button:disabled {
            background: #cccccc; /* グレー */
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }

        /* --------------------------------------------------
           右端の追従ナビ（かわいく変更）
           -------------------------------------------------- */
        .side-nav {
            position: fixed;
            right: 10px;
            top: 85%;
            transform: translateY(-50%);
            z-index: 1000;
        }

        .side-nav a {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: var(--sakura-gradient);
            border-radius: 50%;
            color: white;
            text-decoration: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        
        .side-nav a:hover {
            transform: scale(1.1);
        }

        .side-nav a span {
            font-size: 10px;
            margin-bottom: -2px;
        }
        
        .side-nav a i {
            font-size: 18px;
        }

        /* --------------------------------------------------
           レスポンシブ対応
           -------------------------------------------------- */
        @media (max-width: 600px) {
            .container {
                padding: 25px 20px;
                border-radius: 16px;
            }
            
            h1 {
                font-size: 22px;
            }

            .items-grid {
                grid-template-columns: 1fr; /* スマホは1列 */
            }

            .dt-grid {
                flex-direction: column;
            }

            .label {
                font-size: 16px;
            }

            .logo-image {
                max-width: 160px; /* スマホでは少し小さく */
            }
        }
        
        /* ユーティリティ */
        hr {
            display: none; /* デザイン上の線をCSS borderで代用するため非表示 */
        }
    </style>
</head>

<body>
    <div class="side-nav" id="sideNav">
        <a href="#section-message">
            <span>Scroll</span>
            <i class="fas fa-chevron-down"></i>
        </a>
    </div>

    <div class="container">
        <img src="https://www.dropbox.com/scl/fi/cyv3x3vuhuoccfyeg6x4q/.png?rlkey=1hh0vpuofzdfsy9bc4d2eymgp&st=a30gdlf2&raw=1" alt="サクラ急送" class="logo-image">

        <h1>
            見積依頼フォーム
        </h1>

        <div class="label">お客様名<span class="required">必須</span></div>
        <input type="text" id="name" placeholder="例：桜 花子" oninput="saveInput('name')">

        <div class="label">電話番号<span class="required">必須</span></div>
        <input type="tel" id="phone" placeholder="例：090-1234-5678" oninput="saveInput('phone')">

        <div class="label" id="items-label">
            荷物の種類<span class="required">必須</span>
            <span class="sub-text">(複数選択可)</span>
        </div>
        <div class="items-grid">
            <label class="item-label">
                <input type="checkbox" name="items" value="ベット・寝具（シングル）" onchange="updateItems()">
                ベット・寝具（シングル）
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="ベット・寝具（セミダブル）" onchange="updateItems()">
                ベット・寝具（セミダブル）
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="ベット・寝具（ダブル）" onchange="updateItems()">
                ベット・寝具（ダブル）
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="洗濯機（ドラム）" onchange="updateItems()">
                洗濯機（ドラム）
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="洗濯機（縦型）" onchange="updateItems()">
                洗濯機（縦型）
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="冷蔵庫（2枚扉）" onchange="updateItems()">
                冷蔵庫（2枚扉）
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="冷蔵庫（3枚扉）" onchange="updateItems()">
                冷蔵庫（3枚扉）
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="テレビ" onchange="updateItems()">
                テレビ
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="収納家具" onchange="updateItems()">
                収納家具
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="ダンボール目安〜5箱" onchange="updateItems()">
                ダンボール目安〜5箱
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="ダンボール目安6〜10箱" onchange="updateItems()">
                ダンボール目安6〜10箱
            </label>
            <label class="item-label">
                <input type="checkbox" name="items" value="家電製品（レンジ等）" onchange="updateItems()">
                家電製品（レンジ等）
            </label>
        </div>

        <div class="label" id="floor-label">所在階<span class="required">必須</span></div>
        <input type="text" id="floor" placeholder="例：2 (または 2階)" oninput="saveInput('floor')">

        <div class="label" id="elevator-label">エレベーター有無<span class="required">必須</span></div>
        <div class="elevator-buttons">
            <button type="button" onclick="selectElevator('あり', this)">あり</button>
            <button type="button" onclick="selectElevator('なし', this)">なし</button>
        </div>

        <div class="labelkibounitizi" id="kibou1">希望日時（第1）<span class="required">必須</span></div>
        <div class="datetime-wrapper">
            <span class="placeholder" id="placeholder1">⇩タップして日時を選択⇩</span>
            <input type="hidden" id="date1" name="date1">
            <div class="dt-grid">
                <select id="date1_day" class="datetime-input" aria-label="日付を選択"></select>
                <select id="date1_time" class="datetime-input" aria-label="時間"></select>
            </div>
        </div>

        <div class="labelkibounitizi" id="kibou2">希望日時（第2）<span class="required">必須</span></div>
        <div class="datetime-wrapper">
            <span class="placeholder" id="placeholder2">⇩タップして日時を選択⇩</span>
            <input type="hidden" id="date2" name="date2">
            <div class="dt-grid">
                <select id="date2_day" class="datetime-input" aria-label="日付を選択"></select>
                <select id="date2_time" class="datetime-input" aria-label="時間"></select>
            </div>
        </div>

        <div class="labelkibounitizi" id="kibou3">希望日時（第3）<span class="required">必須</span></div>
        <div class="datetime-wrapper">
            <span class="placeholder" id="placeholder3">⇩タップして日時を選択⇩</span>
            <input type="hidden" id="date3" name="date3">
            <div class="dt-grid">
                <select id="date3_day" class="datetime-input" aria-label="日付を選択"></select>
                <select id="date3_time" class="datetime-input" aria-label="時間"></select>
            </div>
        </div>

        <div class="labelmessezi">ご質問等<span class="sub-text">（お気軽にご記入ください）</span></div>
        <textarea id="message" rows="4" placeholder="特記事項やご要望があれば入力してください"></textarea>

        <div class="labeltyuuou">ご入力内容の確認</div>
        <div id="displayInfo"></div>

        <button class="submit-button" onclick="submitForm()" id="submitBtn">
            <i class="fas fa-paper-plane"></i> 予約・見積を送信する
        </button>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        // サクラ急送用 変数
        let elevatorStatus = ''; // エレベーター有無

        const JP_WD = ['日', '月', '火', '水', '木', '金', '土'];
        const pad = n => String(n).padStart(2, '0');

        document.addEventListener('DOMContentLoaded', function () {
            // LIFF IDは環境に合わせて変更してください
            liff.init({
                liffId: '2005254357-zKma9BZk' 
            }).then(() => {
                console.log('LIFF初期化成功');
            }).catch((err) => {
                console.log('LIFF初期化失敗', err);
            });

            // 初期表示更新
            updateDisplayInfo();
        });

        // 入力内容をローカルストレージに保存
        function saveInput(id) {
            const value = document.getElementById(id).value;
            localStorage.setItem(id, value);
            updateDisplayInfo();
        }

        // ページ読み込み時の復元
        document.addEventListener('DOMContentLoaded', function () {
            const savedName = localStorage.getItem('name');
            const savedPhone = localStorage.getItem('phone');
            const savedFloor = localStorage.getItem('floor');

            if (savedName) document.getElementById('name').value = savedName;
            if (savedPhone) document.getElementById('phone').value = savedPhone;
            if (savedFloor) document.getElementById('floor').value = savedFloor;
        });

        // スムーズスクロール
        document.querySelectorAll('.side-nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 60,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // ---------------------------------------------------------
        // 荷物選択ロジック（チェックボックス）
        // ---------------------------------------------------------
        function updateItems() {
            // CSSのスタイル制御用（:hasが効かない環境向け）
            document.querySelectorAll('.item-label input').forEach(input => {
                const label = input.closest('.item-label');
                if (input.checked) {
                    label.classList.add('checked');
                } else {
                    label.classList.remove('checked');
                }
            });
            updateDisplayInfo();
        }

        function getSelectedItems() {
            const checkboxes = document.querySelectorAll('input[name="items"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // ---------------------------------------------------------
        // エレベーター選択ロジック
        // ---------------------------------------------------------
        function selectElevator(status, button) {
            elevatorStatus = status;
            
            // 全てのボタンからactiveを外す
            const buttons = document.querySelectorAll('.elevator-buttons button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // 押されたボタンにactiveをつける
            button.classList.add('active');
            
            updateDisplayInfo();
        }

        // ---------------------------------------------------------
        // 日付・時間選択ロジック
        // ---------------------------------------------------------
        
        // 日付生成
        function buildDateOptions(selectEl, days = 90, startDate = new Date()) {
            const d = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
            selectEl.innerHTML = '<option value="" disabled selected>日付を選択</option>';

            for (let i = 0; i < days; i++) {
                const wd = d.getDay(); // 0:日, 1:月, 2:火...

                // 火曜日(2)は定休日なので除外
                if (wd === 2) {
                    d.setDate(d.getDate() + 1);
                    continue;
                }

                const y = d.getFullYear();
                const m = pad(d.getMonth() + 1);
                const day = pad(d.getDate());
                const value = `${y}-${m}-${day}`;
                const label = `${y}/${m}/${day}（${JP_WD[wd]}）`;

                const opt = document.createElement('option');
                opt.value = value;
                opt.textContent = label;
                selectEl.appendChild(opt);

                d.setDate(d.getDate() + 1);
            }
        }

        // 時間生成（9:00〜17:30、30分刻み）
        function buildHalfHourOptions(selectEl) {
            selectEl.innerHTML = '<option value="" disabled selected>時間を選択</option>';
            
            const startHour = 9;
            const endHour = 17; // 17時台まで

            for (let h = startHour; h <= endHour; h++) {
                for (const m of [0, 30]) {
                    // 9:00〜17:30なので、17:30まで含める
                    // ループは17:00, 17:30と回るのでそのままでOK
                    
                    const hh = pad(h);
                    const mm = pad(m);
                    const opt = document.createElement('option');
                    opt.value = `${hh}:${mm}`;
                    opt.textContent = `${hh}:${mm}`;
                    selectEl.appendChild(opt);
                }
            }
        }

        function updateHiddenAndPlaceholder(baseId) {
            const day = document.getElementById(`${baseId}_day`).value;
            const time = document.getElementById(`${baseId}_time`).value;
            const hidden = document.getElementById(baseId);
            const ph = document.getElementById(`placeholder${baseId.slice(-1)}`);

            hidden.value = day && time ? `${day}T${time}` : "";
            if (ph) ph.style.display = hidden.value ? 'none' : '';
            updateDisplayInfo();
        }

        function initPicker(baseId) {
            const daySel = document.getElementById(`${baseId}_day`);
            const timeSel = document.getElementById(`${baseId}_time`);

            buildDateOptions(daySel, 90);
            
            // 初期状態
            timeSel.innerHTML = '<option value="" selected hidden>時間を選択</option>';
            timeSel.classList.add('time-disabled');

            daySel.addEventListener('change', () => {
                if (daySel.value) {
                    buildHalfHourOptions(timeSel);
                    timeSel.classList.remove('time-disabled');
                } else {
                    timeSel.classList.add('time-disabled');
                }
                updateHiddenAndPlaceholder(baseId);
            });

            timeSel.addEventListener('change', () => updateHiddenAndPlaceholder(baseId));
        }

        ['date1', 'date2', 'date3'].forEach(id => initPicker(id));

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '未選択';
            const [dPart, tPart] = dateTimeString.split('T');
            if (!dPart || !tPart) return '無効な日時';
            const [year, month, day] = dPart.split('-').map(n => parseInt(n, 10));
            return `${year}年${month}月${day}日 ${tPart}`;
        }

        // ---------------------------------------------------------
        // 表示更新ロジック
        // ---------------------------------------------------------
        function updateDisplayInfo() {
            const name = document.getElementById('name').value;
            const floor = document.getElementById('floor').value;
            
            // チェックされている荷物を取得
            const selectedItems = getSelectedItems();
            
            // 荷物リストHTML
            const itemsHtml = selectedItems.length > 0 
                ? selectedItems.join('、') 
                : '<span style="color:#aaa;">未選択</span>';

            const elevatorHtml = elevatorStatus ? elevatorStatus : '<span style="color:#aaa;">未選択</span>';

            const d1 = formatDateTime(document.getElementById('date1').value);
            const d2 = formatDateTime(document.getElementById('date2').value);
            const d3 = formatDateTime(document.getElementById('date3').value);

            // 修正点1: 階数表示ロジック（「2階」と入力されても「2階階」にならないようにする）
            let floorDisplay = '<span style="color:#ccc">未入力</span>';
            if (floor) {
                // 入力値に「階」が含まれていればそのまま、なければ「階」を足す
                floorDisplay = floor.includes('階') ? floor : floor + '階';
            }

            const displayDiv = document.getElementById('displayInfo');
            displayDiv.innerHTML = `
                <div class="info-row">
                    <div>
                        <strong>【お名前】</strong>
                        <p>${name || '<span style="color:#ccc">未入力</span>'}</p>
                    </div>
                    <button class="edit-button" onclick="scrollToElement('name')">修正</button>
                </div>
                <div class="info-row">
                    <div>
                        <strong>【荷物の種類】</strong>
                        <p>${itemsHtml}</p>
                    </div>
                    <button class="edit-button" onclick="scrollToElement('items-label')">修正</button>
                </div>
                <div class="info-row">
                    <div>
                        <strong>【所在階】</strong>
                        <p>${floorDisplay}</p>
                    </div>
                    <button class="edit-button" onclick="scrollToElement('floor-label')">修正</button>
                </div>
                <div class="info-row">
                    <div>
                        <strong>【エレベーター有無】</strong>
                        <p>${elevatorHtml}</p>
                    </div>
                    <button class="edit-button" onclick="scrollToElement('elevator-label')">修正</button>
                </div>
                <div class="info-row">
                    <div>
                        <strong>【第1希望】</strong>
                        <p>${d1}</p>
                    </div>
                    <button class="edit-button" onclick="scrollToElement('kibou1')">修正</button>
                </div>
                <div class="info-row">
                    <div>
                        <strong>【第2希望】</strong>
                        <p>${d2}</p>
                    </div>
                    <button class="edit-button" onclick="scrollToElement('kibou2')">修正</button>
                </div>
                <div class="info-row">
                    <div>
                        <strong>【第3希望】</strong>
                        <p>${d3}</p>
                    </div>
                    <button class="edit-button" onclick="scrollToElement('kibou3')">修正</button>
                </div>
            `;
        }

        function scrollToElement(id) {
            const element = document.getElementById(id);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // ---------------------------------------------------------
        // 送信処理
        // ---------------------------------------------------------
        function submitForm() {
            const submitBtn = document.getElementById('submitBtn');
            
            // 修正点2: ボタンが無効化されている場合は処理を中断（連打防止）
            if (submitBtn.disabled) return;

            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const floor = document.getElementById('floor').value.trim();
            const message = document.getElementById('message').value.trim();
            const date1 = document.getElementById('date1').value;
            const date2 = document.getElementById('date2').value;
            const date3 = document.getElementById('date3').value;
            const selectedItems = getSelectedItems();

            // バリデーション
            if (!name) return alert('お名前を入力してください。');
            if (!phone) return alert('電話番号を入力してください。');
            if (selectedItems.length === 0) return alert('荷物の種類を1つ以上選択してください。');
            if (!floor) return alert('所在階を入力してください。');
            if (!elevatorStatus) return alert('エレベーターの有無を選択してください。');
            if (!date1) return alert('第1希望日を選択してください。');

            // 修正点2: バリデーション通過後、ボタンを無効化して連打を防ぐ
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 送信中...';

            // 階数の整形（送信テキスト用）
            const floorText = floor.includes('階') ? floor : floor + '階';

            // 送信テキスト作成
            const textToSend = 
`【サクラ急送 予約・見積依頼】
《お名前》
${name}

《電話番号》
${phone}

《荷物の種類》
${selectedItems.join('\n')}

《所在階》
${floorText}

《エレベーター》
${elevatorStatus}

【希望日時】
《第1希望》 ${formatDateTime(date1)}
《第2希望》 ${formatDateTime(date2)}
《第3希望》 ${formatDateTime(date3)}

《ご質問等》
${message}`;

            // LINE送信
            if (!liff.isInClient()) {
                alert('LINEアプリ内から開いてください。\n\n送信内容イメージ：\n' + textToSend);
                // テスト用にボタンを戻す
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> 予約・見積を送信する';
                return;
            }

            liff.sendMessages([{
                type: 'text',
                text: textToSend
            }]).then(() => {
                alert('送信しました！担当者からの連絡をお待ちください。');
                liff.closeWindow();
            }).catch((err) => {
                console.error('送信エラー', err);
                alert('送信に失敗しました。');
                // エラー時はボタンを再度有効化する
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> 予約・見積を送信する';
            });
        }
    </script>
</body>

</html>
